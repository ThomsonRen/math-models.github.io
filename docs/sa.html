

<!DOCTYPE html>

<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta charset="utf-8" />
    <title>6. 模拟退火算法 &#8212; 数学建模系列课程</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.11.2/css/all.min.css" integrity="sha384-KA6wR/X5RY4zFAHpv/CnoG2UW1uogYfdnP67Uv7eULvTveboZJg0qUpmJZb5VqzN" crossorigin="anonymous">
    <link href="../_static/css/index.css" rel="stylesheet">
    <link rel="stylesheet" href="../_static/sphinx-book-theme.css" type="text/css" />
    <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
    <link rel="stylesheet" type="text/css" href="../_static/togglebutton.css" />
    <link rel="stylesheet" type="text/css" href="../_static/copybutton.css" />
    <link rel="stylesheet" type="text/css" href="../_static/mystnb.css" />
    <link rel="stylesheet" type="text/css" href="../_static/sphinx-thebe.css" />
    <link rel="stylesheet" type="text/css" href="../_static/sphinx-dropdown.css" />
    <script id="documentation_options" data-url_root="../" src="../_static/documentation_options.js"></script>
    <script src="../_static/sphinx-book-theme.js"></script>
    <script src="../_static/jquery.js"></script>
    <script src="../_static/underscore.js"></script>
    <script src="../_static/doctools.js"></script>
    <script src="../_static/language_data.js"></script>
    <script src="../_static/togglebutton.js"></script>
    <script src="../_static/clipboard.min.js"></script>
    <script src="../_static/copybutton.js"></script>
    <script src="../_static/sphinx-book-theme.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.4/require.min.js"></script>
    <script >var togglebuttonSelector = '.toggle, .admonition.dropdown, .tag_hide_input div.cell_input, .tag_hide-input div.cell_input, .tag_hide_output div.cell_output, .tag_hide-output div.cell_output, .tag_hide_cell.cell, .tag_hide-cell.cell';</script>
    <script async="async" src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/latest.js?config=TeX-AMS-MML_HTMLorMML"></script>
    <script type="text/x-mathjax-config">MathJax.Hub.Config({"tex2jax": {"inlineMath": [["\\(", "\\)"]], "displayMath": [["\\[", "\\]"]], "processRefs": false, "processEnvironments": false}})</script>
    <script async="async" src="https://unpkg.com/thebelab@latest/lib/index.js"></script>
    <script >
        const thebe_selector = ".thebe"
        const thebe_selector_input = "pre"
        const thebe_selector_output = ".output"
    </script>
    <script async="async" src="../_static/sphinx-thebe.js"></script>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="1. Matplotlib" href="matplotlib.html" />
    <link rel="prev" title="5. 遗传算法" href="ga.html" />

    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta name="docsearch:language" content="en">



  </head>
  <body data-spy="scroll" data-target="#bd-toc-nav" data-offset="80">
    

    <div class="container-xl">
      <div class="row">
          
<div class="col-12 col-md-3 bd-sidebar site-navigation show" id="site-navigation">
    
        <div class="navbar-brand-box">
<a class="navbar-brand text-wrap" href="../index.html">
  
  <img src="../_static/logo.jpeg" class="logo" alt="logo">
  
  
  <h1 class="site-logo" id="site-title">数学建模系列课程</h1>
  
</a>
</div>

<form class="bd-search d-flex align-items-center" action="../search.html" method="get">
  <i class="icon fas fa-search"></i>
  <input type="search" class="form-control" name="q" id="search-input" placeholder="Search this book..." aria-label="Search this book..." autocomplete="off" >
</form>

<nav class="bd-links" id="bd-docs-nav" aria-label="Main navigation">
  <p class="caption">
 <span class="caption-text">
  预备知识
 </span>
</p>
<ul class="nav sidenav_l1">
 <li class="toctree-l1">
  <a class="reference internal" href="contest-intro.html">
   1. HiMCM
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="matrix-and-lg.html">
   2. 矩阵和线性代数基础回顾
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="anaconda.html">
   3. Jupyter notebook 安装教程
  </a>
 </li>
</ul>
<p class="caption">
 <span class="caption-text">
  数学建模基础课
 </span>
</p>
<ul class="nav sidenav_l1">
 <li class="toctree-l1">
  <a class="reference internal" href="LP.html">
   1. 规划模型
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="evaluation_model.html">
   2. 评价模型
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="prediction_model.html">
   3. 预测模型
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="ode_model.html">
   4. 微分方程模型
  </a>
 </li>
</ul>
<p class="caption">
 <span class="caption-text">
  数学建模高阶课
 </span>
</p>
<ul class="current nav sidenav_l1">
 <li class="toctree-l1">
  <a class="reference internal" href="monte-carlo.html">
   1. 蒙特卡洛模拟
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="markov-chain.html">
   2. 马氏链模型
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="queue-model.html">
   3. 排队论模型
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="clustering.html">
   4. 聚类分析
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="ga.html">
   5. 遗传算法
  </a>
 </li>
 <li class="toctree-l1 current active">
  <a class="current reference internal" href="#">
   6. 模拟退火算法
  </a>
 </li>
</ul>
<p class="caption">
 <span class="caption-text">
  数据可视化
 </span>
</p>
<ul class="nav sidenav_l1">
 <li class="toctree-l1">
  <a class="reference internal" href="matplotlib.html">
   1. Matplotlib
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="seaborn-1.html">
   2. Seaborn-1
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="seaborn-2.html">
   3. Seaborn-2
  </a>
 </li>
</ul>
<p class="caption">
 <span class="caption-text">
  作业解答
 </span>
</p>
<ul class="nav sidenav_l1">
 <li class="toctree-l1">
  <a class="reference internal" href="answers.html">
   1. 作业解答
  </a>
 </li>
</ul>

</nav>

 <!-- To handle the deprecated key -->

<div class="navbar_extra_footer">
  Powered by <a href="https://jupyterbook.org">Jupyter Book</a>
</div>

</div>


          


          
<main class="col py-md-3 pl-md-4 bd-content overflow-auto" role="main">
    
    <div class="row topbar fixed-top container-xl">
    <div class="col-12 col-md-3 bd-topbar-whitespace site-navigation show">
    </div>
    <div class="col pl-2 topbar-main">
        
        <button id="navbar-toggler" class="navbar-toggler ml-0" type="button" data-toggle="collapse"
            data-toggle="tooltip" data-placement="bottom" data-target=".site-navigation" aria-controls="navbar-menu"
            aria-expanded="true" aria-label="Toggle navigation" aria-controls="site-navigation"
            title="Toggle navigation" data-toggle="tooltip" data-placement="left">
            <i class="fas fa-bars"></i>
            <i class="fas fa-arrow-left"></i>
            <i class="fas fa-arrow-up"></i>
        </button>
        
        <div class="dropdown-buttons-trigger">
    <button id="dropdown-buttons-trigger" class="btn btn-secondary topbarbtn" aria-label="Download this page"><i
            class="fas fa-download"></i></button>

    
    <div class="dropdown-buttons">
        <!-- ipynb file if we had a myst markdown file -->
        <a class="dropdown-buttons"
            href="../_sources/docs/sa.ipynb"><button type="button"
                class="btn btn-secondary topbarbtn" title="Download notebook file" data-toggle="tooltip"
                data-placement="left">.ipynb</button></a>
        <!-- Download raw file -->
        <a class="dropdown-buttons" href="../_sources/docs/sa.md"><button type="button"
                class="btn btn-secondary topbarbtn" title="Download source file" data-toggle="tooltip"
                data-placement="left">.md</button></a>
        <!-- Download PDF via print -->
        <button type="button" id="download-print" class="btn btn-secondary topbarbtn" title="Print to PDF"
            onClick="window.print()" data-toggle="tooltip" data-placement="left">.pdf</button>
    </div>
    
</div>
        <!-- Source interaction buttons -->


        <!-- Full screen (wrap in <a> to have style consistency -->
        <a class="full-screen-button"><button type="button" class="btn btn-secondary topbarbtn" data-toggle="tooltip"
                data-placement="bottom" onclick="toggleFullScreen()" title="Fullscreen mode"><i
                    class="fas fa-expand"></i></button></a>

        <!-- Launch buttons -->

<div class="dropdown-buttons-trigger">
    <button id="dropdown-buttons-trigger" class="btn btn-secondary topbarbtn"
        aria-label="Launch interactive content"><i class="fas fa-rocket"></i></button>
    <div class="dropdown-buttons">
        
        <a class="binder-button" href="https://mybinder.org/v2/gh/executablebooks/jupyter-book/master?urlpath=tree/docs/sa.md"><button type="button"
                class="btn btn-secondary topbarbtn" title="Launch Binder" data-toggle="tooltip"
                data-placement="left"><img class="binder-button-logo"
                    src="../_static/images/logo_binder.svg"
                    alt="Interact on binder">Binder</button></a>
        
        
        
        
    </div>
</div>

    </div>

    <!-- Table of contents -->
    <div class="d-none d-md-block col-md-2 bd-toc show">
        <div class="tocsection onthispage pt-5 pb-3">
            <i class="fas fa-list"></i> Contents
        </div>
        <nav id="bd-toc-nav">
            <ul class="nav section-nav flex-column">
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#id2">
   6.1. 物理学中的退火
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#boltzman">
   6.2. Boltzman 概率分布
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#metropolis">
   6.3. 劣解接受概率（Metropolis准则）
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#id3">
   6.4. 温度初始化和更新
  </a>
  <ul class="nav section-nav flex-column">
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#id4">
     6.4.1. 温度初始化
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#id5">
     6.4.2. 温度更新
    </a>
    <ul class="nav section-nav flex-column">
     <li class="toc-h4 nav-item toc-entry">
      <a class="reference internal nav-link" href="#id6">
       6.4.2.1. 更新函数1:对数函数
      </a>
     </li>
     <li class="toc-h4 nav-item toc-entry">
      <a class="reference internal nav-link" href="#id7">
       6.4.2.2. 线性函数
      </a>
     </li>
     <li class="toc-h4 nav-item toc-entry">
      <a class="reference internal nav-link" href="#id8">
       6.4.2.3. 更新函数3：反比例函数
      </a>
     </li>
    </ul>
   </li>
  </ul>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#id9">
   6.5. 算法步骤
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#id10">
   6.6. 小结
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#id11">
   6.7. 例1代码实现：函数寻优（最小值）
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#tsp">
   6.8. 例2代码实现：求解TSP
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#id12">
   6.9. 模拟退火算法总结
  </a>
 </li>
</ul>

        </nav>
    </div>
</div>
    <div id="main-content" class="row">
        <div class="col-12 col-md-9 pl-md-3 pr-md-0">
        
              <div>
                
  <div class="section" id="id1">
<h1><span class="section-number">6. </span>模拟退火算法<a class="headerlink" href="#id1" title="Permalink to this headline">¶</a></h1>
<p>模拟退火算法 (Simulated Annealing，SA) 最早的思想是由 N. Metropolis 等人于1953年提出。1983年, S. Kirkpatrick 等成功地将退火思想引入到组合优化领域。它是<strong>基于 Monte-Carlo 迭代求解策略的一种随机寻优算法</strong>，其出发点是基于物理中固体物质的退火过程与一般组合优化问题之间的相似性。模拟退火算法从某一较高初温出发，伴随温度参数的不断下降,结合概率突跳特性在解空间中随机寻找目标函数的全局最优解，即在局部最优解能概率性地跳出并最终趋于全局最优。</p>
<p>与具有陷入局部最小值的缺点的基于梯度的方法(也就是刚才提到的爬山法)以及其他确定性搜索方法不同，SA 的主要优势在于其具有避免陷入局部最小值的能力。事实上，已经证明，如果足够的随机性与非常缓慢的冷却结合使用，模拟退火将收敛到其全局最优性。实质上，SA 是一种搜索算法，<strong>可以视为马尔可夫链</strong>，能够在合适的条件下收敛。</p>
<p>模拟退火在建模比赛中最主要的应用是模型求解，特别是最优化问题（组合优化问题），如旅行商问题 ( TSP）、最大截问题(Max Cut Problem)、0-1背包问题(Zero OneKnapsack Problem)、图着色问题(Graph Colouring Problem)、调度问题(Scheduling Problem)等等。</p>
<div class="section" id="id2">
<h2><span class="section-number">6.1. </span>物理学中的退火<a class="headerlink" href="#id2" title="Permalink to this headline">¶</a></h2>
<p><strong>加温过程</strong>：增强粒子运动，消除系统原先可能存在的非均匀态。</p>
<p><strong>等温过程</strong>：对于与环境换热而温度不变的封闭系统，系统状态的自发变化总是朝自由能减少的方向进行，当自由能达到最小时，系统达到平衡。</p>
<p><strong>冷却过程</strong>：使粒子热运动减弱并渐趋有序，系统能量逐渐下降，从而得到低能的晶体结构。</p>
</div>
<div class="section" id="boltzman">
<h2><span class="section-number">6.2. </span>Boltzman 概率分布<a class="headerlink" href="#boltzman" title="Permalink to this headline">¶</a></h2>
<p>在统计学中，玻尔兹曼分布的表达形式为</p>
<div class="math notranslate nohighlight">
\[
F(state) \propto  e^{-E/kT}
\]</div>
<p>上式中，<span class="math notranslate nohighlight">\(E\)</span>是能量状态，<span class="math notranslate nohighlight">\(kT\)</span>是玻尔兹曼常数和热力学温度的乘积。</p>
<p>系统的两种状态之间的玻尔兹曼分布比率称为玻尔兹曼因子，</p>
<div class="math notranslate nohighlight">
\[
\dfrac{F(state1) }{F(state2) } = e^{-(E_1 - E_2 )/kT}
\]</div>
<ul class="simple">
<li><p>同一个温度，分子停留在能量小状态的概率大于停留在能量大状态的概率</p></li>
<li><p>温度越高，不同能量状态对应的概率相差越小，温度足够高时，各状态对应概率基本相同。</p></li>
<li><p>随着温度的下降，能量最低状态对应概率越来越大，温度趋于0时，其状态趋于1</p></li>
</ul>
</div>
<div class="section" id="metropolis">
<h2><span class="section-number">6.3. </span>劣解接受概率（Metropolis准则）<a class="headerlink" href="#metropolis" title="Permalink to this headline">¶</a></h2>
<p>劣解接受概率又称做状态接受函数，这里是模拟退火法这个名字的来源，模仿固体退火原理，随着温度的下降（迭代次数上升），能量逐渐稳定。即劣解的接受概率<span class="math notranslate nohighlight">\(p\)</span>逐渐下降，其公式为：</p>
<div class="math notranslate nohighlight">
\[\begin{split}
\displaystyle
p=\left\{\begin{array}{ll}{1,} &amp; {E\left(x_{new}\right) &lt; E\left(x_{o l d}\right)} \\ {\exp \left({-\dfrac{E\left(x_{n e w}\right)-E\left(x_{o l d}\right)}{T}}\right),} &amp; {E\left(x_{n e w}\right) \geq E\left(x_{o l d}\right)}\end{array}\right.
\end{split}\]</div>
<p>从公式中可以看出这是求最小值时的分布，因为当新的解小于旧解时百分百接受。又可以看出当<span class="math notranslate nohighlight">\(E\left(x_{n e w}\right) \geq E\left(x_{o l d}\right)\)</span>时，<span class="math notranslate nohighlight">\(p\)</span>恒在[0, 1]之间。可以看到，随着时间推移，温度越低，对于劣解的接受概率越低。</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">plt</span>
<span class="n">deltaEList</span> <span class="o">=</span> <span class="p">[</span><span class="mi">10</span><span class="p">,</span><span class="mi">20</span><span class="p">,</span><span class="mi">30</span><span class="p">,</span><span class="mi">40</span><span class="p">,</span><span class="mi">50</span><span class="p">]</span>
<span class="k">for</span> <span class="n">deltaE</span> <span class="ow">in</span> <span class="n">deltaEList</span><span class="p">:</span>
    <span class="n">p_list</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">t_list</span> <span class="o">=</span> <span class="p">[</span><span class="n">i</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">25</span><span class="p">,</span><span class="mi">100</span><span class="p">)]</span>
    <span class="k">for</span> <span class="n">T</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">25</span><span class="p">,</span><span class="mi">100</span><span class="p">):</span>
        <span class="n">p_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="o">-</span> <span class="n">deltaE</span><span class="o">/</span><span class="n">T</span><span class="p">))</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">t_list</span><span class="p">,</span><span class="n">p_list</span><span class="p">,</span><span class="n">label</span> <span class="o">=</span> <span class="sa">r</span><span class="s1">&#39;$\Delta E$ = &#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">deltaE</span><span class="p">))</span>
<span class="n">plt</span><span class="o">.</span><span class="n">legend</span><span class="p">()</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="sa">r</span><span class="s1">&#39;$T$&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="sa">r</span><span class="s1">&#39;$p$&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Text(0, 0.5, &#39;$p$&#39;)
</pre></div>
</div>
<img alt="../_images/sa_1_1.png" src="../_images/sa_1_1.png" />
</div>
</div>
</div>
<div class="section" id="id3">
<h2><span class="section-number">6.4. </span>温度初始化和更新<a class="headerlink" href="#id3" title="Permalink to this headline">¶</a></h2>
<div class="section" id="id4">
<h3><span class="section-number">6.4.1. </span>温度初始化<a class="headerlink" href="#id4" title="Permalink to this headline">¶</a></h3>
<p>关于初始温度，初温越大，获得高质量解的机率越大，但花费较多的计算时间，原理可以从上面的图中或者结合下面温度随时间变化进行理解、解释，温度越高对于劣解的接受能力越大（搜索范围越大），下降速度越慢（求解速度下降）。</p>
<p>关于初始解如何设定一般有以下方法：</p>
<p>（1）按照某一概率分布抽样一组<span class="math notranslate nohighlight">\(K\)</span>个解，以<span class="math notranslate nohighlight">\(K\)</span>个解的目标值的方差为初温（下面使用的时正态分布）。</p>
<p>（2）随机产生一组<span class="math notranslate nohighlight">\(K\)</span>个状态，确定两两状态间的最大目标差值，根据差值，利用一定的函数确定初温。</p>
<p>（3）利用经验公式。</p>
</div>
<div class="section" id="id5">
<h3><span class="section-number">6.4.2. </span>温度更新<a class="headerlink" href="#id5" title="Permalink to this headline">¶</a></h3>
<div class="section" id="id6">
<h4><span class="section-number">6.4.2.1. </span>更新函数1:对数函数<a class="headerlink" href="#id6" title="Permalink to this headline">¶</a></h4>
<div class="math notranslate nohighlight">
\[
T(t+1)=\frac{T_{0}}{\ln (1+t)}
\]</div>
<p>如果使用这种温度更新，不管初始温度如何，都有一个先加热后散热的过程。即先提高搜索范围，再慢慢的减少搜索范围。</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">T0_list</span> <span class="o">=</span> <span class="p">[</span><span class="mi">1000</span><span class="p">,</span><span class="mi">500</span><span class="p">,</span><span class="mi">200</span><span class="p">,</span><span class="mi">100</span><span class="p">]</span>
<span class="k">for</span> <span class="n">T0</span> <span class="ow">in</span> <span class="n">T0_list</span><span class="p">:</span>
    <span class="n">T_list</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">t_list</span> <span class="o">=</span> <span class="p">[</span><span class="n">i</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">40</span><span class="p">)]</span>
    <span class="n">T_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">T0</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">t</span> <span class="ow">in</span> <span class="n">t_list</span><span class="p">:</span>
        <span class="n">T_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">T0</span><span class="o">/</span><span class="n">np</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="n">t</span><span class="o">+</span><span class="mi">1</span><span class="p">))</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">([</span><span class="n">i</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">40</span><span class="p">)],</span><span class="n">T_list</span><span class="p">,</span><span class="n">label</span> <span class="o">=</span> <span class="s1">&#39;T0 = &#39;</span><span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">T0</span><span class="p">))</span>
<span class="n">plt</span><span class="o">.</span><span class="n">legend</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>&lt;matplotlib.legend.Legend at 0x1221634d0&gt;
</pre></div>
</div>
<img alt="../_images/sa_3_1.png" src="../_images/sa_3_1.png" />
</div>
</div>
</div>
<div class="section" id="id7">
<h4><span class="section-number">6.4.2.2. </span>线性函数<a class="headerlink" href="#id7" title="Permalink to this headline">¶</a></h4>
<div class="math notranslate nohighlight">
\[
T(t+1)= \alpha T(t), \alpha \in (0,1)
\]</div>
<p>指数衰减，通常<span class="math notranslate nohighlight">\(0.8 &lt; \alpha &lt;0.99\)</span>。</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">T0_list</span> <span class="o">=</span> <span class="p">[</span><span class="mi">1000</span><span class="p">,</span><span class="mi">500</span><span class="p">,</span><span class="mi">200</span><span class="p">,</span><span class="mi">100</span><span class="p">]</span>
<span class="n">alpha</span> <span class="o">=</span> <span class="mf">0.99</span>
<span class="k">for</span> <span class="n">T0</span> <span class="ow">in</span> <span class="n">T0_list</span><span class="p">:</span>
    <span class="n">T_list</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">t_list</span> <span class="o">=</span> <span class="p">[</span><span class="n">i</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">400</span><span class="p">)]</span>
    <span class="n">T_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">T0</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">t</span> <span class="ow">in</span> <span class="n">t_list</span><span class="p">:</span>
        <span class="n">T_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">alpha</span> <span class="o">*</span> <span class="n">T_list</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">([</span><span class="n">i</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">400</span><span class="p">)],</span><span class="n">T_list</span><span class="p">,</span><span class="n">label</span> <span class="o">=</span> <span class="s1">&#39;T0 = &#39;</span><span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">T0</span><span class="p">))</span>
<span class="n">plt</span><span class="o">.</span><span class="n">legend</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>&lt;matplotlib.legend.Legend at 0x12231e5d0&gt;
</pre></div>
</div>
<img alt="../_images/sa_5_1.png" src="../_images/sa_5_1.png" />
</div>
</div>
</div>
<div class="section" id="id8">
<h4><span class="section-number">6.4.2.3. </span>更新函数3：反比例函数<a class="headerlink" href="#id8" title="Permalink to this headline">¶</a></h4>
<div class="math notranslate nohighlight">
\[
T(t)=  \frac{T_{0}}{1+t}
\]</div>
<p>t是迭代次数。按照反比例函数衰减，类似更新函数2。</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">T0_list</span> <span class="o">=</span> <span class="p">[</span><span class="mi">1000</span><span class="p">,</span><span class="mi">500</span><span class="p">,</span><span class="mi">200</span><span class="p">,</span><span class="mi">100</span><span class="p">]</span>
<span class="n">alpha</span> <span class="o">=</span> <span class="mf">0.99</span>
<span class="k">for</span> <span class="n">T0</span> <span class="ow">in</span> <span class="n">T0_list</span><span class="p">:</span>
    <span class="n">T_list</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">t_list</span> <span class="o">=</span> <span class="p">[</span><span class="n">i</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">40</span><span class="p">)]</span>
    <span class="n">T_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">T0</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">t</span> <span class="ow">in</span> <span class="n">t_list</span><span class="p">:</span>
        <span class="n">T_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">T0</span><span class="o">/</span><span class="p">(</span><span class="n">t</span><span class="o">+</span><span class="mi">1</span><span class="p">))</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">([</span><span class="n">i</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">40</span><span class="p">)],</span><span class="n">T_list</span><span class="p">,</span><span class="n">label</span> <span class="o">=</span> <span class="s1">&#39;T0 = &#39;</span><span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">T0</span><span class="p">))</span>
<span class="n">plt</span><span class="o">.</span><span class="n">legend</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>&lt;matplotlib.legend.Legend at 0x122501b50&gt;
</pre></div>
</div>
<img alt="../_images/sa_7_1.png" src="../_images/sa_7_1.png" />
</div>
</div>
</div>
</div>
</div>
<div class="section" id="id9">
<h2><span class="section-number">6.5. </span>算法步骤<a class="headerlink" href="#id9" title="Permalink to this headline">¶</a></h2>
<p><img alt="Image Name" src="https://cdn.kesci.com/upload/image/q3w7sz5x3e.png?imageView2/0/w/960/h/960" /></p>
<p><strong>步骤</strong></p>
<ol class="simple">
<li><p>初始化温度<span class="math notranslate nohighlight">\(T\)</span>，初始解状态<span class="math notranslate nohighlight">\(S\)</span>，每个温度<span class="math notranslate nohighlight">\(t\)</span>下的迭代次数<span class="math notranslate nohighlight">\(L\)</span>；</p></li>
<li><p>当<span class="math notranslate nohighlight">\(k = 1,2,\cdots,L\)</span>时，进行3~6；</p></li>
<li><p>对当前解进行变换得到新解<span class="math notranslate nohighlight">\(S'\)</span>（例如对某些解中的元素进行互换，置换）；</p></li>
<li><p>计算增量<span class="math notranslate nohighlight">\(\Delta t'=C(S')-C(S)\)</span>，其中<span class="math notranslate nohighlight">\(C(S)\)</span>为评价函数；</p></li>
<li><p>若<span class="math notranslate nohighlight">\(\Delta t'&lt;0\)</span>则接受<span class="math notranslate nohighlight">\(S'\)</span>作为新的当前解，否则以概率<span class="math notranslate nohighlight">\(e^{-\Delta t'/(KT)}\)</span>接受<span class="math notranslate nohighlight">\(S′\)</span>作为新的当前解(<span class="math notranslate nohighlight">\(K\)</span>为玻尔兹曼常数，数值为：<span class="math notranslate nohighlight">\(K=1.380650× 10^{-23} J/K\)</span>）；（实际上，为了简便运算，而又不失一般性，通常忽略<span class="math notranslate nohighlight">\(K\)</span>，令<span class="math notranslate nohighlight">\(K=1\)</span>）</p></li>
<li><p>如果满足终止条件则输出当前解作为最优解，结束程序；</p></li>
<li><p>减小<span class="math notranslate nohighlight">\(T\)</span>，转到第2步，直到<span class="math notranslate nohighlight">\(T\)</span>小于初始设定的阈值。</p></li>
</ol>
</div>
<div class="section" id="id10">
<h2><span class="section-number">6.6. </span>小结<a class="headerlink" href="#id10" title="Permalink to this headline">¶</a></h2>
<p>模拟退火其实也是一种Greedy算法，但是它的搜索过程引入了随机因素。**模拟退火算法以一定的概率来接受一个比当前解要差的解，因此有可能会跳出这个局部的最优解，达到全局的最优解。**以上图为例，模拟退火算法在搜索到局部最优解B后，会以一定的概率接受向右继续移动。也许经过几次这样的不是局部最优的移动后会到达B 和C之间的峰点，于是就跳出了局部最小值B。</p>
<p><img alt="Image Name" src="https://cdn.kesci.com/upload/image/q3w7vbb61r.png?imageView2/0/w/960/h/960" /></p>
<p>模拟退火算法来源于固体退火原理，将固体加温至充分高，再让其徐徐冷却，加温时，固体内部粒子随温升变为无序状，内能增大，而徐徐冷却时粒子渐趋有序，在每个温度都达到平衡态，最后在常温时达到基态，内能减为最小。</p>
<p>根据 Metropolis 准则，粒子在温度<span class="math notranslate nohighlight">\(T\)</span>时趋于平衡的概率为<span class="math notranslate nohighlight">\(e^{-\frac{\Delta E}{kT}}\)</span>，其中<span class="math notranslate nohighlight">\(E\)</span>为温度<span class="math notranslate nohighlight">\(T\)</span>时的内能，<span class="math notranslate nohighlight">\(\Delta E\)</span>为其改变量，<span class="math notranslate nohighlight">\(k\)</span>为 Boltzmann 常数。</p>
<p>用固体退火模拟组合优化问题，将内能<span class="math notranslate nohighlight">\(E\)</span>模拟为目标函数值<span class="math notranslate nohighlight">\(f\)</span>，温度<span class="math notranslate nohighlight">\(T\)</span>演化成控制参数<span class="math notranslate nohighlight">\(t\)</span>，即得到解组合优化问题的模拟退火算法：</p>
<p>由初始解i和控制参数初值t开始，对当前解重复“产生新解→计算目标函数差→接受或舍弃”的迭代，并逐步衰减<span class="math notranslate nohighlight">\(t\)</span>值，算法终止时的当前解即为所得近似最优解，这是基于蒙特卡罗迭代求解法的一种启发式随机搜索过程。退火过程由冷却进度表(Cooling Schedule)控制，包括控制参数的初值<span class="math notranslate nohighlight">\(t\)</span>及其衰减因子<span class="math notranslate nohighlight">\(\Delta t\)</span>、每个<span class="math notranslate nohighlight">\(t\)</span>值时的迭代次数<span class="math notranslate nohighlight">\(L\)</span>和停止条件<span class="math notranslate nohighlight">\(S\)</span>。</p>
<p>让我们实现例1、2的模拟退火算法，特别关注：</p>
<ul class="simple">
<li><p>初始化方法、</p></li>
<li><p>温度更新方法、</p></li>
<li><p>产生新解方法</p></li>
</ul>
</div>
<div class="section" id="id11">
<h2><span class="section-number">6.7. </span>例1代码实现：函数寻优（最小值）<a class="headerlink" href="#id11" title="Permalink to this headline">¶</a></h2>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="o">%</span><span class="k">matplotlib</span> inline
<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">plt</span>
<span class="kn">import</span> <span class="nn">math</span>
 
<span class="c1">#define aim function</span>
<span class="k">def</span> <span class="nf">aimFunction</span><span class="p">(</span><span class="n">x</span><span class="p">):</span>
    <span class="n">y</span><span class="o">=</span><span class="n">x</span><span class="o">**</span><span class="mi">3</span><span class="o">-</span><span class="mi">60</span><span class="o">*</span><span class="n">x</span><span class="o">**</span><span class="mi">2</span><span class="o">-</span><span class="mi">4</span><span class="o">*</span><span class="n">x</span><span class="o">+</span><span class="mi">6</span>
    <span class="k">return</span> <span class="n">y</span>
<span class="n">x</span><span class="o">=</span><span class="p">[</span><span class="n">i</span><span class="o">/</span><span class="mi">10</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1000</span><span class="p">)]</span>
<span class="n">y</span><span class="o">=</span><span class="p">[</span><span class="mi">0</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1000</span><span class="p">)]</span>
<span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1000</span><span class="p">):</span>
    <span class="n">y</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">=</span><span class="n">aimFunction</span><span class="p">(</span><span class="n">x</span><span class="p">[</span><span class="n">i</span><span class="p">])</span>
 
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">x</span><span class="p">,</span><span class="n">y</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>[&lt;matplotlib.lines.Line2D at 0x1226a4d10&gt;]
</pre></div>
</div>
<img alt="../_images/sa_10_1.png" src="../_images/sa_10_1.png" />
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">T</span><span class="o">=</span><span class="mi">1000</span> <span class="c1">#initiate temperature</span>
<span class="n">Tmin</span><span class="o">=</span><span class="mi">10</span> <span class="c1">#minimum value of terperature</span>
<span class="n">x</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">uniform</span><span class="p">(</span><span class="n">low</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span><span class="n">high</span><span class="o">=</span><span class="mi">100</span><span class="p">)</span><span class="c1">#initiate x</span>
<span class="n">k</span><span class="o">=</span><span class="mi">50</span> <span class="c1">#times of internal circulation </span>
<span class="n">y</span><span class="o">=</span><span class="mi">0</span><span class="c1">#initiate result</span>
<span class="n">t</span><span class="o">=</span><span class="mi">0</span><span class="c1">#time</span>
<span class="k">while</span> <span class="n">T</span><span class="o">&gt;=</span><span class="n">Tmin</span><span class="p">:</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">k</span><span class="p">):</span>
        <span class="c1">#calculate y</span>
        <span class="n">y</span><span class="o">=</span><span class="n">aimFunction</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
        <span class="c1">#generate a new x in the neighboorhood of x by transform function</span>
        <span class="n">xNew</span><span class="o">=</span><span class="n">x</span><span class="o">+</span><span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">uniform</span><span class="p">(</span><span class="n">low</span><span class="o">=-</span><span class="mf">0.055</span><span class="p">,</span><span class="n">high</span><span class="o">=</span><span class="mf">0.055</span><span class="p">)</span><span class="o">*</span><span class="n">T</span>
        <span class="k">if</span> <span class="p">(</span><span class="mi">0</span><span class="o">&lt;=</span><span class="n">xNew</span> <span class="ow">and</span> <span class="n">xNew</span><span class="o">&lt;=</span><span class="mi">100</span><span class="p">):</span>
            <span class="n">yNew</span><span class="o">=</span><span class="n">aimFunction</span><span class="p">(</span><span class="n">xNew</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">yNew</span><span class="o">-</span><span class="n">y</span><span class="o">&lt;</span><span class="mi">0</span><span class="p">:</span>
                <span class="n">x</span><span class="o">=</span><span class="n">xNew</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="c1">#metropolis principle</span>
                <span class="n">p</span><span class="o">=</span><span class="n">math</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="o">-</span><span class="p">(</span><span class="n">yNew</span><span class="o">-</span><span class="n">y</span><span class="p">)</span><span class="o">/</span><span class="n">T</span><span class="p">)</span>
                <span class="n">r</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">uniform</span><span class="p">(</span><span class="n">low</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span><span class="n">high</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
                <span class="k">if</span> <span class="n">r</span><span class="o">&lt;</span><span class="n">p</span><span class="p">:</span>
                    <span class="n">x</span><span class="o">=</span><span class="n">xNew</span>
    <span class="n">t</span><span class="o">+=</span><span class="mi">1</span>
<span class="c1">#     print (t)</span>
    <span class="n">T</span><span class="o">=</span><span class="mi">1000</span><span class="o">/</span><span class="p">(</span><span class="mi">1</span><span class="o">+</span><span class="n">t</span><span class="p">)</span>
    
<span class="nb">print</span> <span class="p">(</span><span class="s1">&#39;x:&#39;</span><span class="p">,</span><span class="n">x</span><span class="p">,</span><span class="s1">&#39;|y:&#39;</span><span class="p">,</span><span class="n">aimFunction</span><span class="p">(</span><span class="n">x</span><span class="p">))</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>x: 39.83648406351726 |y: -32151.746060566093
</pre></div>
</div>
</div>
</div>
</div>
<div class="section" id="tsp">
<h2><span class="section-number">6.8. </span>例2代码实现：求解TSP<a class="headerlink" href="#tsp" title="Permalink to this headline">¶</a></h2>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">num</span> <span class="o">=</span> <span class="mi">52</span>
<span class="n">solutionnew</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="n">num</span><span class="p">)</span>
<span class="n">solutionnew</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>array([ 0,  1,  2,  3,  4,  5,  6,  7,  8,  9, 10, 11, 12, 13, 14, 15, 16,
       17, 18, 19, 20, 21, 22, 23, 24, 25, 26, 27, 28, 29, 30, 31, 32, 33,
       34, 35, 36, 37, 38, 39, 40, 41, 42, 43, 44, 45, 46, 47, 48, 49, 50,
       51])
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">plt</span> 
<span class="kn">import</span> <span class="nn">pdb</span>
 
<span class="s2">&quot;旅行商问题 ( TSP , Traveling Salesman Problem )&quot;</span>
<span class="n">coordinates</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([[</span><span class="mf">565.0</span><span class="p">,</span><span class="mf">575.0</span><span class="p">],[</span><span class="mf">25.0</span><span class="p">,</span><span class="mf">185.0</span><span class="p">],[</span><span class="mf">345.0</span><span class="p">,</span><span class="mf">750.0</span><span class="p">],[</span><span class="mf">945.0</span><span class="p">,</span><span class="mf">685.0</span><span class="p">],[</span><span class="mf">845.0</span><span class="p">,</span><span class="mf">655.0</span><span class="p">],</span>
                        <span class="p">[</span><span class="mf">880.0</span><span class="p">,</span><span class="mf">660.0</span><span class="p">],[</span><span class="mf">25.0</span><span class="p">,</span><span class="mf">230.0</span><span class="p">],[</span><span class="mf">525.0</span><span class="p">,</span><span class="mf">1000.0</span><span class="p">],[</span><span class="mf">580.0</span><span class="p">,</span><span class="mf">1175.0</span><span class="p">],[</span><span class="mf">650.0</span><span class="p">,</span><span class="mf">1130.0</span><span class="p">],</span>
                        <span class="p">[</span><span class="mf">1605.0</span><span class="p">,</span><span class="mf">620.0</span><span class="p">],[</span><span class="mf">1220.0</span><span class="p">,</span><span class="mf">580.0</span><span class="p">],[</span><span class="mf">1465.0</span><span class="p">,</span><span class="mf">200.0</span><span class="p">],[</span><span class="mf">1530.0</span><span class="p">,</span>  <span class="mf">5.0</span><span class="p">],[</span><span class="mf">845.0</span><span class="p">,</span><span class="mf">680.0</span><span class="p">],</span>
                        <span class="p">[</span><span class="mf">725.0</span><span class="p">,</span><span class="mf">370.0</span><span class="p">],[</span><span class="mf">145.0</span><span class="p">,</span><span class="mf">665.0</span><span class="p">],[</span><span class="mf">415.0</span><span class="p">,</span><span class="mf">635.0</span><span class="p">],[</span><span class="mf">510.0</span><span class="p">,</span><span class="mf">875.0</span><span class="p">],[</span><span class="mf">560.0</span><span class="p">,</span><span class="mf">365.0</span><span class="p">],</span>
                        <span class="p">[</span><span class="mf">300.0</span><span class="p">,</span><span class="mf">465.0</span><span class="p">],[</span><span class="mf">520.0</span><span class="p">,</span><span class="mf">585.0</span><span class="p">],[</span><span class="mf">480.0</span><span class="p">,</span><span class="mf">415.0</span><span class="p">],[</span><span class="mf">835.0</span><span class="p">,</span><span class="mf">625.0</span><span class="p">],[</span><span class="mf">975.0</span><span class="p">,</span><span class="mf">580.0</span><span class="p">],</span>
                        <span class="p">[</span><span class="mf">1215.0</span><span class="p">,</span><span class="mf">245.0</span><span class="p">],[</span><span class="mf">1320.0</span><span class="p">,</span><span class="mf">315.0</span><span class="p">],[</span><span class="mf">1250.0</span><span class="p">,</span><span class="mf">400.0</span><span class="p">],[</span><span class="mf">660.0</span><span class="p">,</span><span class="mf">180.0</span><span class="p">],[</span><span class="mf">410.0</span><span class="p">,</span><span class="mf">250.0</span><span class="p">],</span>
                        <span class="p">[</span><span class="mf">420.0</span><span class="p">,</span><span class="mf">555.0</span><span class="p">],[</span><span class="mf">575.0</span><span class="p">,</span><span class="mf">665.0</span><span class="p">],[</span><span class="mf">1150.0</span><span class="p">,</span><span class="mf">1160.0</span><span class="p">],[</span><span class="mf">700.0</span><span class="p">,</span><span class="mf">580.0</span><span class="p">],[</span><span class="mf">685.0</span><span class="p">,</span><span class="mf">595.0</span><span class="p">],</span>
                        <span class="p">[</span><span class="mf">685.0</span><span class="p">,</span><span class="mf">610.0</span><span class="p">],[</span><span class="mf">770.0</span><span class="p">,</span><span class="mf">610.0</span><span class="p">],[</span><span class="mf">795.0</span><span class="p">,</span><span class="mf">645.0</span><span class="p">],[</span><span class="mf">720.0</span><span class="p">,</span><span class="mf">635.0</span><span class="p">],[</span><span class="mf">760.0</span><span class="p">,</span><span class="mf">650.0</span><span class="p">],</span>
                        <span class="p">[</span><span class="mf">475.0</span><span class="p">,</span><span class="mf">960.0</span><span class="p">],[</span><span class="mf">95.0</span><span class="p">,</span><span class="mf">260.0</span><span class="p">],[</span><span class="mf">875.0</span><span class="p">,</span><span class="mf">920.0</span><span class="p">],[</span><span class="mf">700.0</span><span class="p">,</span><span class="mf">500.0</span><span class="p">],[</span><span class="mf">555.0</span><span class="p">,</span><span class="mf">815.0</span><span class="p">],</span>
                        <span class="p">[</span><span class="mf">830.0</span><span class="p">,</span><span class="mf">485.0</span><span class="p">],[</span><span class="mf">1170.0</span><span class="p">,</span> <span class="mf">65.0</span><span class="p">],[</span><span class="mf">830.0</span><span class="p">,</span><span class="mf">610.0</span><span class="p">],[</span><span class="mf">605.0</span><span class="p">,</span><span class="mf">625.0</span><span class="p">],[</span><span class="mf">595.0</span><span class="p">,</span><span class="mf">360.0</span><span class="p">],</span>
                        <span class="p">[</span><span class="mf">1340.0</span><span class="p">,</span><span class="mf">725.0</span><span class="p">],[</span><span class="mf">1740.0</span><span class="p">,</span><span class="mf">245.0</span><span class="p">]])</span>
 
<span class="c1">#得到距离矩阵的函数</span>
<span class="k">def</span> <span class="nf">getdistmat</span><span class="p">(</span><span class="n">coordinates</span><span class="p">):</span>
    <span class="n">num</span> <span class="o">=</span> <span class="n">coordinates</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="c1">#52个坐标点</span>
    <span class="n">distmat</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="mi">52</span><span class="p">,</span><span class="mi">52</span><span class="p">))</span> <span class="c1">#52X52距离矩阵</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">num</span><span class="p">):</span>
        <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">i</span><span class="p">,</span><span class="n">num</span><span class="p">):</span>
            <span class="n">distmat</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="n">j</span><span class="p">]</span> <span class="o">=</span> <span class="n">distmat</span><span class="p">[</span><span class="n">j</span><span class="p">][</span><span class="n">i</span><span class="p">]</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">linalg</span><span class="o">.</span><span class="n">norm</span><span class="p">(</span><span class="n">coordinates</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">-</span><span class="n">coordinates</span><span class="p">[</span><span class="n">j</span><span class="p">])</span>
    <span class="k">return</span> <span class="n">distmat</span>
 
<span class="k">def</span> <span class="nf">initpara</span><span class="p">():</span>
    <span class="n">alpha</span> <span class="o">=</span> <span class="mf">0.99</span>
    <span class="n">t</span> <span class="o">=</span> <span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">100</span><span class="p">)</span>
    <span class="n">markovlen</span> <span class="o">=</span> <span class="mi">1000</span>
 
    <span class="k">return</span> <span class="n">alpha</span><span class="p">,</span><span class="n">t</span><span class="p">,</span><span class="n">markovlen</span>
<span class="n">num</span> <span class="o">=</span> <span class="n">coordinates</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
<span class="n">distmat</span> <span class="o">=</span> <span class="n">getdistmat</span><span class="p">(</span><span class="n">coordinates</span><span class="p">)</span> <span class="c1">#得到距离矩阵</span>
 
 
<span class="n">solutionnew</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="n">num</span><span class="p">)</span>
<span class="c1">#valuenew = np.max(num)</span>
 
<span class="n">solutioncurrent</span> <span class="o">=</span> <span class="n">solutionnew</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
<span class="n">valuecurrent</span> <span class="o">=</span><span class="mi">99000</span>  <span class="c1">#np.max这样的源代码可能同样是因为版本问题被当做函数不能正确使用，应取一个较大值作为初始值</span>
<span class="c1">#print(valuecurrent)</span>
 
<span class="n">solutionbest</span> <span class="o">=</span> <span class="n">solutionnew</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
<span class="n">valuebest</span> <span class="o">=</span> <span class="mi">99000</span> <span class="c1">#np.max</span>
 
<span class="n">alpha</span><span class="p">,</span><span class="n">t2</span><span class="p">,</span><span class="n">markovlen</span> <span class="o">=</span> <span class="n">initpara</span><span class="p">()</span>
<span class="n">t</span> <span class="o">=</span> <span class="n">t2</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
 
<span class="n">result</span> <span class="o">=</span> <span class="p">[]</span> <span class="c1">#记录迭代过程中的最优解</span>
<span class="k">while</span> <span class="n">t</span> <span class="o">&gt;</span> <span class="n">t2</span><span class="p">[</span><span class="mi">0</span><span class="p">]:</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="n">markovlen</span><span class="p">):</span>
 
        <span class="c1">#下面的两交换和三交换是两种扰动方式，用于产生新解</span>
        <span class="k">if</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">rand</span><span class="p">()</span> <span class="o">&gt;</span> <span class="mf">0.5</span><span class="p">:</span><span class="c1"># 交换路径中的这2个节点的顺序</span>
            <span class="c1"># np.random.rand()产生[0, 1)区间的均匀随机数</span>
            <span class="k">while</span> <span class="kc">True</span><span class="p">:</span><span class="c1">#产生两个不同的随机数</span>
                <span class="n">loc1</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">int</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">ceil</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">rand</span><span class="p">()</span><span class="o">*</span><span class="p">(</span><span class="n">num</span><span class="o">-</span><span class="mi">1</span><span class="p">)))</span>
                <span class="n">loc2</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">int</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">ceil</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">rand</span><span class="p">()</span><span class="o">*</span><span class="p">(</span><span class="n">num</span><span class="o">-</span><span class="mi">1</span><span class="p">)))</span>
                <span class="c1">## print(loc1,loc2)</span>
                <span class="k">if</span> <span class="n">loc1</span> <span class="o">!=</span> <span class="n">loc2</span><span class="p">:</span>
                    <span class="k">break</span>
            <span class="n">solutionnew</span><span class="p">[</span><span class="n">loc1</span><span class="p">],</span><span class="n">solutionnew</span><span class="p">[</span><span class="n">loc2</span><span class="p">]</span> <span class="o">=</span> <span class="n">solutionnew</span><span class="p">[</span><span class="n">loc2</span><span class="p">],</span><span class="n">solutionnew</span><span class="p">[</span><span class="n">loc1</span><span class="p">]</span>
        <span class="k">else</span><span class="p">:</span> <span class="c1">#三交换</span>
            <span class="k">while</span> <span class="kc">True</span><span class="p">:</span>
                <span class="n">loc1</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">int</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">ceil</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">rand</span><span class="p">()</span><span class="o">*</span><span class="p">(</span><span class="n">num</span><span class="o">-</span><span class="mi">1</span><span class="p">)))</span>
                <span class="n">loc2</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">int</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">ceil</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">rand</span><span class="p">()</span><span class="o">*</span><span class="p">(</span><span class="n">num</span><span class="o">-</span><span class="mi">1</span><span class="p">)))</span> 
                <span class="n">loc3</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">int</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">ceil</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">rand</span><span class="p">()</span><span class="o">*</span><span class="p">(</span><span class="n">num</span><span class="o">-</span><span class="mi">1</span><span class="p">)))</span>
 
                <span class="k">if</span><span class="p">((</span><span class="n">loc1</span> <span class="o">!=</span> <span class="n">loc2</span><span class="p">)</span><span class="o">&amp;</span><span class="p">(</span><span class="n">loc2</span> <span class="o">!=</span> <span class="n">loc3</span><span class="p">)</span><span class="o">&amp;</span><span class="p">(</span><span class="n">loc1</span> <span class="o">!=</span> <span class="n">loc3</span><span class="p">)):</span>
                    <span class="k">break</span>
 
            <span class="c1"># 下面的三个判断语句使得loc1&lt;loc2&lt;loc3</span>
            <span class="k">if</span> <span class="n">loc1</span> <span class="o">&gt;</span> <span class="n">loc2</span><span class="p">:</span>
                <span class="n">loc1</span><span class="p">,</span><span class="n">loc2</span> <span class="o">=</span> <span class="n">loc2</span><span class="p">,</span><span class="n">loc1</span>
            <span class="k">if</span> <span class="n">loc2</span> <span class="o">&gt;</span> <span class="n">loc3</span><span class="p">:</span>
                <span class="n">loc2</span><span class="p">,</span><span class="n">loc3</span> <span class="o">=</span> <span class="n">loc3</span><span class="p">,</span><span class="n">loc2</span>
            <span class="k">if</span> <span class="n">loc1</span> <span class="o">&gt;</span> <span class="n">loc2</span><span class="p">:</span>
                <span class="n">loc1</span><span class="p">,</span><span class="n">loc2</span> <span class="o">=</span> <span class="n">loc2</span><span class="p">,</span><span class="n">loc1</span>
 
            <span class="c1">#下面的三行代码将[loc1,loc2)区间的数据插入到loc3之后</span>
            <span class="n">tmplist</span> <span class="o">=</span> <span class="n">solutionnew</span><span class="p">[</span><span class="n">loc1</span><span class="p">:</span><span class="n">loc2</span><span class="p">]</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
            <span class="n">solutionnew</span><span class="p">[</span><span class="n">loc1</span><span class="p">:</span><span class="n">loc3</span><span class="o">-</span><span class="n">loc2</span><span class="o">+</span><span class="mi">1</span><span class="o">+</span><span class="n">loc1</span><span class="p">]</span> <span class="o">=</span> <span class="n">solutionnew</span><span class="p">[</span><span class="n">loc2</span><span class="p">:</span><span class="n">loc3</span><span class="o">+</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
            <span class="n">solutionnew</span><span class="p">[</span><span class="n">loc3</span><span class="o">-</span><span class="n">loc2</span><span class="o">+</span><span class="mi">1</span><span class="o">+</span><span class="n">loc1</span><span class="p">:</span><span class="n">loc3</span><span class="o">+</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">tmplist</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>  
 
        <span class="n">valuenew</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">num</span><span class="o">-</span><span class="mi">1</span><span class="p">):</span>
            <span class="n">valuenew</span> <span class="o">+=</span> <span class="n">distmat</span><span class="p">[</span><span class="n">solutionnew</span><span class="p">[</span><span class="n">i</span><span class="p">]][</span><span class="n">solutionnew</span><span class="p">[</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">]]</span>
        <span class="n">valuenew</span> <span class="o">+=</span> <span class="n">distmat</span><span class="p">[</span><span class="n">solutionnew</span><span class="p">[</span><span class="mi">0</span><span class="p">]][</span><span class="n">solutionnew</span><span class="p">[</span><span class="mi">51</span><span class="p">]]</span>
       <span class="c1"># print (valuenew)</span>
        <span class="k">if</span> <span class="n">valuenew</span><span class="o">&lt;</span><span class="n">valuecurrent</span><span class="p">:</span> <span class="c1">#接受该解</span>
           
            <span class="c1">#更新solutioncurrent 和solutionbest</span>
            <span class="n">valuecurrent</span> <span class="o">=</span> <span class="n">valuenew</span>
            <span class="n">solutioncurrent</span> <span class="o">=</span> <span class="n">solutionnew</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
 
            <span class="k">if</span> <span class="n">valuenew</span> <span class="o">&lt;</span> <span class="n">valuebest</span><span class="p">:</span>
                <span class="n">valuebest</span> <span class="o">=</span> <span class="n">valuenew</span>
                <span class="n">solutionbest</span> <span class="o">=</span> <span class="n">solutionnew</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
        <span class="k">else</span><span class="p">:</span><span class="c1">#按一定的概率接受该解</span>
            <span class="k">if</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">rand</span><span class="p">()</span> <span class="o">&lt;</span> <span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="o">-</span><span class="p">(</span><span class="n">valuenew</span><span class="o">-</span><span class="n">valuecurrent</span><span class="p">)</span><span class="o">/</span><span class="n">t</span><span class="p">):</span>
                <span class="n">valuecurrent</span> <span class="o">=</span> <span class="n">valuenew</span>
                <span class="n">solutioncurrent</span> <span class="o">=</span> <span class="n">solutionnew</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">solutionnew</span> <span class="o">=</span> <span class="n">solutioncurrent</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
    <span class="n">t</span> <span class="o">=</span> <span class="n">alpha</span><span class="o">*</span><span class="n">t</span>
    <span class="n">result</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">valuebest</span><span class="p">)</span>
    <span class="c1"># print (t) #程序运行时间较长，打印t来监视程序进展速度</span>
<span class="c1">#用来显示结果</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">result</span><span class="p">))</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s2">&quot;bestvalue&quot;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s2">&quot;t&quot;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../_images/sa_14_0.png" src="../_images/sa_14_0.png" />
</div>
</div>
</div>
<div class="section" id="id12">
<h2><span class="section-number">6.9. </span>模拟退火算法总结<a class="headerlink" href="#id12" title="Permalink to this headline">¶</a></h2>
<ul class="simple">
<li><p>迭代搜索效率高，并且可以并行化；</p></li>
<li><p>算法中有一定概率接受比当前解较差的解，因此一定程度上可以跳出局部最优；</p></li>
<li><p>算法求得的解与初始解状态S无关，因此有一定的鲁棒性；</p></li>
<li><p>具有渐近收敛性，已在理论上被证明是一种以概率l收敛于全局最优解的全局优化算法。</p></li>
</ul>
</div>
</div>

    <script type="text/x-thebe-config">
    {
        requestKernel: true,
        binderOptions: {
            repo: "binder-examples/jupyter-stacks-datascience",
            ref: "master",
        },
        codeMirrorConfig: {
            theme: "abcdef",
            mode: "python"
        },
        kernelOptions: {
            kernelName: "python3",
            path: "./docs"
        },
        predefinedOutput: true
    }
    </script>
    <script>kernelName = 'python3'</script>

              </div>
              
        </div>
    </div>
    
    
    <div class='prev-next-bottom'>
        
    <a class='left-prev' id="prev-link" href="ga.html" title="previous page"><span class="section-number">5. </span>遗传算法</a>
    <a class='right-next' id="next-link" href="matplotlib.html" title="next page"><span class="section-number">1. </span>Matplotlib</a>

    </div>
    <footer class="footer mt-5 mt-md-0">
    <div class="container">
      <p>
        
          By The Jupyter Book community<br/>
        
            &copy; Copyright 2020.<br/>
      </p>
    </div>
  </footer>
</main>


      </div>
    </div>

    <script src="../_static/js/index.js"></script>
    
  </body>
</html>