

<!DOCTYPE html>

<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta charset="utf-8" />
    <title>3. 预测模型 &#8212; 数学建模系列课程</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.11.2/css/all.min.css" integrity="sha384-KA6wR/X5RY4zFAHpv/CnoG2UW1uogYfdnP67Uv7eULvTveboZJg0qUpmJZb5VqzN" crossorigin="anonymous">
    <link href="../_static/css/index.css" rel="stylesheet">
    <link rel="stylesheet" href="../_static/sphinx-book-theme.css" type="text/css" />
    <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
    <link rel="stylesheet" type="text/css" href="../_static/togglebutton.css" />
    <link rel="stylesheet" type="text/css" href="../_static/copybutton.css" />
    <link rel="stylesheet" type="text/css" href="../_static/mystnb.css" />
    <link rel="stylesheet" type="text/css" href="../_static/sphinx-thebe.css" />
    <link rel="stylesheet" type="text/css" href="../_static/sphinx-dropdown.css" />
    <script id="documentation_options" data-url_root="../" src="../_static/documentation_options.js"></script>
    <script src="../_static/sphinx-book-theme.js"></script>
    <script src="../_static/jquery.js"></script>
    <script src="../_static/underscore.js"></script>
    <script src="../_static/doctools.js"></script>
    <script src="../_static/language_data.js"></script>
    <script src="../_static/togglebutton.js"></script>
    <script src="../_static/clipboard.min.js"></script>
    <script src="../_static/copybutton.js"></script>
    <script src="../_static/sphinx-book-theme.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.4/require.min.js"></script>
    <script >var togglebuttonSelector = '.toggle, .admonition.dropdown, .tag_hide_input div.cell_input, .tag_hide-input div.cell_input, .tag_hide_output div.cell_output, .tag_hide-output div.cell_output, .tag_hide_cell.cell, .tag_hide-cell.cell';</script>
    <script async="async" src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/latest.js?config=TeX-AMS-MML_HTMLorMML"></script>
    <script type="text/x-mathjax-config">MathJax.Hub.Config({"tex2jax": {"inlineMath": [["\\(", "\\)"]], "displayMath": [["\\[", "\\]"]], "processRefs": false, "processEnvironments": false}})</script>
    <script async="async" src="https://unpkg.com/thebelab@latest/lib/index.js"></script>
    <script >
        const thebe_selector = ".thebe"
        const thebe_selector_input = "pre"
        const thebe_selector_output = ".output"
    </script>
    <script async="async" src="../_static/sphinx-thebe.js"></script>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="4. 微分方程模型" href="ode_model.html" />
    <link rel="prev" title="2. 评价模型" href="evaluation_model.html" />

    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta name="docsearch:language" content="en">



  </head>
  <body data-spy="scroll" data-target="#bd-toc-nav" data-offset="80">
    

    <div class="container-xl">
      <div class="row">
          
<div class="col-12 col-md-3 bd-sidebar site-navigation show" id="site-navigation">
    
        <div class="navbar-brand-box">
<a class="navbar-brand text-wrap" href="../index.html">
  
  <img src="../_static/logo.jpeg" class="logo" alt="logo">
  
  
  <h1 class="site-logo" id="site-title">数学建模系列课程</h1>
  
</a>
</div>

<form class="bd-search d-flex align-items-center" action="../search.html" method="get">
  <i class="icon fas fa-search"></i>
  <input type="search" class="form-control" name="q" id="search-input" placeholder="Search this book..." aria-label="Search this book..." autocomplete="off" >
</form>

<nav class="bd-links" id="bd-docs-nav" aria-label="Main navigation">
  <p class="caption">
 <span class="caption-text">
  预备知识
 </span>
</p>
<ul class="nav sidenav_l1">
 <li class="toctree-l1">
  <a class="reference internal" href="contest-intro.html">
   1. HiMCM
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="matrix-and-lg.html">
   2. 矩阵和线性代数基础回顾
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="anaconda.html">
   3. Jupyter notebook 安装教程
  </a>
 </li>
</ul>
<p class="caption">
 <span class="caption-text">
  数学建模基础课
 </span>
</p>
<ul class="current nav sidenav_l1">
 <li class="toctree-l1">
  <a class="reference internal" href="LP.html">
   1. 规划模型
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="evaluation_model.html">
   2. 评价模型
  </a>
 </li>
 <li class="toctree-l1 current active">
  <a class="current reference internal" href="#">
   3. 预测模型
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="ode_model.html">
   4. 微分方程模型
  </a>
 </li>
</ul>
<p class="caption">
 <span class="caption-text">
  数学建模高阶课
 </span>
</p>
<ul class="nav sidenav_l1">
 <li class="toctree-l1">
  <a class="reference internal" href="monte-carlo.html">
   1. 蒙特卡洛模拟
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="markov-chain.html">
   2. 马氏链模型
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="queue-model.html">
   3. 排队论模型
  </a>
 </li>
</ul>
<p class="caption">
 <span class="caption-text">
  数据可视化
 </span>
</p>
<ul class="nav sidenav_l1">
 <li class="toctree-l1">
  <a class="reference internal" href="matplotlib.html">
   1. Matplotlib
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="seaborn-1.html">
   2. Seaborn-1
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="seaborn-2.html">
   3. Seaborn-2
  </a>
 </li>
</ul>
<p class="caption">
 <span class="caption-text">
  作业解答
 </span>
</p>
<ul class="nav sidenav_l1">
 <li class="toctree-l1">
  <a class="reference internal" href="answers.html">
   1. 作业解答
  </a>
 </li>
</ul>

</nav>

 <!-- To handle the deprecated key -->

<div class="navbar_extra_footer">
  Powered by <a href="https://jupyterbook.org">Jupyter Book</a>
</div>

</div>


          


          
<main class="col py-md-3 pl-md-4 bd-content overflow-auto" role="main">
    
    <div class="row topbar fixed-top container-xl">
    <div class="col-12 col-md-3 bd-topbar-whitespace site-navigation show">
    </div>
    <div class="col pl-2 topbar-main">
        
        <button id="navbar-toggler" class="navbar-toggler ml-0" type="button" data-toggle="collapse"
            data-toggle="tooltip" data-placement="bottom" data-target=".site-navigation" aria-controls="navbar-menu"
            aria-expanded="true" aria-label="Toggle navigation" aria-controls="site-navigation"
            title="Toggle navigation" data-toggle="tooltip" data-placement="left">
            <i class="fas fa-bars"></i>
            <i class="fas fa-arrow-left"></i>
            <i class="fas fa-arrow-up"></i>
        </button>
        
        <div class="dropdown-buttons-trigger">
    <button id="dropdown-buttons-trigger" class="btn btn-secondary topbarbtn" aria-label="Download this page"><i
            class="fas fa-download"></i></button>

    
    <div class="dropdown-buttons">
        <!-- ipynb file if we had a myst markdown file -->
        <a class="dropdown-buttons"
            href="../_sources/docs/prediction_model.ipynb"><button type="button"
                class="btn btn-secondary topbarbtn" title="Download notebook file" data-toggle="tooltip"
                data-placement="left">.ipynb</button></a>
        <!-- Download raw file -->
        <a class="dropdown-buttons" href="../_sources/docs/prediction_model.md"><button type="button"
                class="btn btn-secondary topbarbtn" title="Download source file" data-toggle="tooltip"
                data-placement="left">.md</button></a>
        <!-- Download PDF via print -->
        <button type="button" id="download-print" class="btn btn-secondary topbarbtn" title="Print to PDF"
            onClick="window.print()" data-toggle="tooltip" data-placement="left">.pdf</button>
    </div>
    
</div>
        <!-- Source interaction buttons -->


        <!-- Full screen (wrap in <a> to have style consistency -->
        <a class="full-screen-button"><button type="button" class="btn btn-secondary topbarbtn" data-toggle="tooltip"
                data-placement="bottom" onclick="toggleFullScreen()" title="Fullscreen mode"><i
                    class="fas fa-expand"></i></button></a>

        <!-- Launch buttons -->

<div class="dropdown-buttons-trigger">
    <button id="dropdown-buttons-trigger" class="btn btn-secondary topbarbtn"
        aria-label="Launch interactive content"><i class="fas fa-rocket"></i></button>
    <div class="dropdown-buttons">
        
        <a class="binder-button" href="https://mybinder.org/v2/gh/executablebooks/jupyter-book/master?urlpath=tree/docs/prediction_model.md"><button type="button"
                class="btn btn-secondary topbarbtn" title="Launch Binder" data-toggle="tooltip"
                data-placement="left"><img class="binder-button-logo"
                    src="../_static/images/logo_binder.svg"
                    alt="Interact on binder">Binder</button></a>
        
        
        
        
    </div>
</div>

    </div>

    <!-- Table of contents -->
    <div class="d-none d-md-block col-md-2 bd-toc show">
        <div class="tocsection onthispage pt-5 pb-3">
            <i class="fas fa-list"></i> Contents
        </div>
        <nav id="bd-toc-nav">
            <ul class="nav section-nav flex-column">
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#id2">
   3.1. 预测模型介绍
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#id4">
   3.2. 线性回归
  </a>
  <ul class="nav section-nav flex-column">
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#id5">
     3.2.1. 一元线性回归模型
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#id6">
     3.2.2. 多元线性回归模型
    </a>
   </li>
  </ul>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#id7">
   3.3. 非线性拟合
  </a>
  <ul class="nav section-nav flex-column">
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#polynomial-regression">
     3.3.1. 多项式拟合（Polynomial regression）
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#id8">
     3.3.2. 一元其他非线性函数拟合
    </a>
   </li>
  </ul>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#id9">
   3.4. 时间序列方法
  </a>
  <ul class="nav section-nav flex-column">
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#id10">
     3.4.1. 移动平均法
    </a>
    <ul class="nav section-nav flex-column">
     <li class="toc-h4 nav-item toc-entry">
      <a class="reference internal nav-link" href="#id11">
       3.4.1.1. 简单移动平均法
      </a>
     </li>
     <li class="toc-h4 nav-item toc-entry">
      <a class="reference internal nav-link" href="#id12">
       3.4.1.2. 加权移动平均法
      </a>
     </li>
     <li class="toc-h4 nav-item toc-entry">
      <a class="reference internal nav-link" href="#id13">
       3.4.1.3. 趋势移动平均法
      </a>
     </li>
     <li class="toc-h4 nav-item toc-entry">
      <a class="reference internal nav-link" href="#id14">
       3.4.1.4. 自适应滤波法
      </a>
     </li>
    </ul>
   </li>
  </ul>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#id15">
   3.5. 预测方法总结
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#id16">
   3.6. 练习
  </a>
 </li>
</ul>

        </nav>
    </div>
</div>
    <div id="main-content" class="row">
        <div class="col-12 col-md-9 pl-md-3 pr-md-0">
        
              <div>
                
  <div class="section" id="id1">
<h1><span class="section-number">3. </span>预测模型<a class="headerlink" href="#id1" title="Permalink to this headline">¶</a></h1>
<div class="section" id="id2">
<h2><span class="section-number">3.1. </span>预测模型介绍<a class="headerlink" href="#id2" title="Permalink to this headline">¶</a></h2>
<div class="figure align-default" id="directive-fig3">
<a class="reference internal image-reference" href="../_images/pred.jpg"><img alt="../_images/pred.jpg" src="../_images/pred.jpg" style="height: 300px;" /></a>
</div>
<p><strong>预测</strong>(Prediction)是根据事物的历史资料及现状，运用一定的理论和方法，探求事物演变规律，对其未来发展状况作出的一种科学推测。生活中使用预测模型的场景比如：</p>
<ul class="simple">
<li><p>天气预报</p></li>
<li><p>飞机晚点预测</p></li>
<li><p>房价预测</p></li>
<li><p>股市</p></li>
</ul>
<p>随着科学技术的发展和各种预测实践经验的积累，预测作为一门综合性科学已发展成为一门比较完善的学科，现在预测方法已近二百种（最常用的有十几种），但每种方法都有一定的使用范围，它们往往是相互补充的，实际预测时也常常是几种方法一起用。预测方法虽然很多，但到目前为止，还没有一个统一的、普遍适用的分类体系，若根据预测的性质，大体可将预测分为<strong>定性预测</strong>和<strong>定量预测</strong>两类。</p>
<div class="figure align-default" id="id3">
<a class="reference internal image-reference" href="https://cdn.kesci.com/upload/image/q32dm25jw8.png?imageView2/0"><img alt="https://cdn.kesci.com/upload/image/q32dm25jw8.png?imageView2/0" src="https://cdn.kesci.com/upload/image/q32dm25jw8.png?imageView2/0" style="height: 450px;" /></a>
</div>
<div class="admonition- admonition">
<p class="admonition-title">因果预测与时间序列预测</p>
<p>定量预测的特点是偏重于利用统计资料，借助于数学方法建立数学模型进行预测，是以数学模型为主的预测方法。又可分为<strong>因果预测</strong>和<strong>时间序列预测</strong>。</p>
<ul class="simple">
<li><p><strong>因果预测</strong>是以相关原理来分析预测对象与有关因素的相互关系，并以此关系构造模型进行预测。例如，要预测人的血压与年龄的关系、贫血与缺铁的关系等都可以用此预测方法。常用的因果预测模型有<strong>回归分析、数量经济模型、灰色系统模型、生命周期分析</strong>等。</p></li>
<li><p><strong>时间序列预测</strong>是根据预测对象时间序列的变化特征，来研究事物自身的发展规律和探讨未来发展趋势的。时间序列与因果预测的最重要区别就在于其研究的是“自身”的变化规律而不是因素之间的关系。</p></li>
</ul>
</div>
</div>
<div class="section" id="id4">
<h2><span class="section-number">3.2. </span>线性回归<a class="headerlink" href="#id4" title="Permalink to this headline">¶</a></h2>
<p>深入地学习线性回归之前，我们先来理清楚几个概念</p>
<div class="admonition- admonition">
<p class="admonition-title">概念梳理</p>
<ul class="simple">
<li><p><strong>确定性关系和相关关系：</strong></p>
<ul>
<li><p><strong>参数之间的确定性关系是指某参数可以完全由其他参数所决定</strong>，例如正方形的面积与边长的关系，总价格与单价和数量的关系等。</p></li>
<li><p><strong>相关关系是指一个或多个变量之间有一定的联系，但是这个联系不是完全决定性的</strong>。例如，人的身高与体重有一定的关系，一般来讲身高高的人体重相对大一些。但是它们之间不能用一个确定的表达式表示出来。这次变量之间的关系。我们称之为相关关系。又如环境因素与农作物的产量也有相关关系，因为在相同环境条件下农作物的产量也有区别，这也就是说农作物的产量是一个随机变量。</p></li>
</ul>
</li>
<li><p><strong>回归分析</strong>：回归分析就是研究相关关系的一种数学方法，是寻找不完全确定的变量间的数学关系式并进行统计推断的一种方法。它能帮助我们从一个变量取得的值去估计另一个变量的值。</p></li>
<li><p><strong>线性回归</strong>：回归分析中最简单的是线性回归。</p></li>
</ul>
</div>
<div class="section" id="id5">
<h3><span class="section-number">3.2.1. </span>一元线性回归模型<a class="headerlink" href="#id5" title="Permalink to this headline">¶</a></h3>
<p>单变量线性回归，又称简单线性回归（simple linear regression,SLR），是最简单但用途很广的回归模型。其回归式为：</p>
<div class="math notranslate nohighlight">
\[
y=\alpha+\beta x
\]</div>
<p>为了从一组样本<span class="math notranslate nohighlight">\(\{\left(x_{i}, y_{i}\right)|i = 1,2,\cdots,n\}\)</span>之中估计最合适的参数<span class="math notranslate nohighlight">\(\alpha\)</span>和<span class="math notranslate nohighlight">\(\beta\)</span>，通常采用<strong>最小二乘法</strong>，其计算目标为<strong>最小化残差平方和</strong>：</p>
<div class="math notranslate nohighlight">
\[
\min \sum_{i=1}^{n} \varepsilon_{i}^{2}=\min \sum_{i=1}^{n}\left(y_{i}-\alpha-\beta x_{i}\right)^{2}
\]</div>
<div class="admonition tip">
<p class="admonition-title">Tip</p>
<p><strong>本课程我们暂不关心最小二乘法的推导过程，只需了解其原理及应用即可。感兴趣的同学可以参看<a class="reference external" href="https://web.williams.edu/Mathematics/sjmiller/public_html/BrownClasses/54/handouts/MethodLeastSquares.pdf">这里</a></strong></p>
</div>
<p>我们不加推导，直接给出最小二乘估计的结果</p>
<div class="math notranslate nohighlight">
\[\begin{split}
\begin{aligned}
\hat{\alpha}&amp;=\bar{y}-\bar{x} \hat{\beta}\\
\hat{\beta}&amp;=S_{x y} / S_{x x}
\end{aligned}
\end{split}\]</div>
<p>其中，</p>
<div class="math notranslate nohighlight">
\[
\bar{y}=\frac{1}{n} \sum_{i} y_{i}
\]</div>
<div class="math notranslate nohighlight">
\[
\bar{x}=\frac{1}{n} \sum_{i} x_{i}
\]</div>
<div class="math notranslate nohighlight">
\[
S_{x x}=\sum_{i}\left(x_{i}-\bar{x}\right)^{2}
\]</div>
<div class="math notranslate nohighlight">
\[
S_{y y}=\sum_{i}\left(y_{i}-\bar{y}\right)^{2}
\]</div>
<div class="math notranslate nohighlight">
\[
S_{x y}=\sum_{i}\left(x_{i}-\bar{x}\right)\left(y_{i}-\bar{y}\right)
\]</div>
<p>现在有一组高中生的身高和腿长的数据，用一元线性回归研究他们之间的关系，然后对新的同学进行预测。先来看看数据的<strong>散点图</strong></p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>    <span class="c1"># 导入 numpy库，用于科学计算</span>
<span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="nn">pd</span>    <span class="c1"># 导入 pandas库 ，用于数据分析</span>
<span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">plt</span>   <span class="c1"># 导入 pandas库 ，用于数据可视化</span>

<span class="o">%</span><span class="k">matplotlib</span> inline 
<span class="n">plt</span><span class="o">.</span><span class="n">style</span><span class="o">.</span><span class="n">use</span><span class="p">(</span><span class="s2">&quot;ggplot&quot;</span><span class="p">)</span>  <span class="c1"># 使用ggplot绘图风格</span>
<span class="kn">from</span> <span class="nn">sklearn.linear_model</span> <span class="kn">import</span> <span class="n">LinearRegression</span>  <span class="c1"># 导入线性回归工具函数 LinearRegression</span>
<span class="n">x</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mi">143</span><span class="p">,</span> <span class="mi">145</span><span class="p">,</span> <span class="mi">146</span><span class="p">,</span> <span class="mi">147</span><span class="p">,</span> <span class="mi">149</span><span class="p">,</span> <span class="mi">150</span><span class="p">,</span> <span class="mi">153</span><span class="p">,</span> <span class="mi">154</span><span class="p">,</span> <span class="mi">155</span><span class="p">,</span>
              <span class="mi">156</span><span class="p">,</span> <span class="mi">157</span><span class="p">,</span> <span class="mi">158</span><span class="p">,</span> <span class="mi">159</span><span class="p">,</span> <span class="mi">160</span><span class="p">,</span> <span class="mi">162</span><span class="p">,</span> <span class="mi">164</span><span class="p">])</span>  <span class="c1"># 输入x数据</span>
<span class="n">x</span> <span class="o">=</span> <span class="n">x</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="mi">16</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>    <span class="c1"># 修改数据的格式，从行向量转换为列向量</span>
<span class="n">y</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mi">88</span><span class="p">,</span> <span class="mi">85</span><span class="p">,</span> <span class="mi">88</span><span class="p">,</span> <span class="mi">91</span><span class="p">,</span> <span class="mi">92</span><span class="p">,</span> <span class="mi">93</span><span class="p">,</span> <span class="mi">93</span><span class="p">,</span> <span class="mi">95</span><span class="p">,</span> <span class="mi">96</span><span class="p">,</span>
              <span class="mi">98</span><span class="p">,</span> <span class="mi">97</span><span class="p">,</span> <span class="mi">96</span><span class="p">,</span> <span class="mi">98</span><span class="p">,</span> <span class="mi">99</span><span class="p">,</span> <span class="mi">100</span><span class="p">,</span> <span class="mi">102</span><span class="p">])</span>  <span class="c1"># 输入y数据</span>
<span class="n">plt</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">)</span>    <span class="c1"># 绘制散点图</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="sa">r</span><span class="s1">&#39;$H$&#39;</span><span class="p">)</span>  <span class="c1"># 添加xlabel</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="sa">r</span><span class="s1">&#39;$L$&#39;</span><span class="p">)</span>  <span class="c1"># 绘制ylabel</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Text(0, 0.5, &#39;$L$&#39;)
</pre></div>
</div>
<img alt="../_images/prediction_model_4_1.png" src="../_images/prediction_model_4_1.png" />
</div>
</div>
<p>很明显，升身高和体重明显<strong>符合线性关系</strong>。下面我们使用<code class="docutils literal notranslate"><span class="pre">sklearn.linear_model</span></code>中的<code class="docutils literal notranslate"><span class="pre">LinearRegression</span></code>方法进行线性回归</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># 1. 初始化线性回归函数，命名为lrModel</span>
<span class="n">lrModel</span> <span class="o">=</span> <span class="n">LinearRegression</span><span class="p">()</span>
<span class="c1"># 2. 使用lrModel对数据x,y进行拟合</span>
<span class="n">lrModel</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">x</span><span class="p">,</span><span class="n">y</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>LinearRegression()
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># 3. 输出截距和斜率</span>
<span class="nb">print</span><span class="p">(</span><span class="n">lrModel</span><span class="o">.</span><span class="n">intercept_</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">lrModel</span><span class="o">.</span><span class="n">coef_</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>-16.07298072980727
[0.71935219]
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># 4. 根据回归得到的系数，在散点图上绘制回归直线</span>
<span class="n">LR_data</span> <span class="o">=</span> <span class="p">[</span><span class="n">lrModel</span><span class="o">.</span><span class="n">intercept_</span> <span class="o">+</span> <span class="n">lrModel</span><span class="o">.</span><span class="n">coef_</span> <span class="o">*</span> <span class="n">i</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">145</span><span class="p">,</span><span class="mi">165</span><span class="p">)]</span>  <span class="c1"># 求解回归直线上的一系列点</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="mi">145</span><span class="p">,</span> <span class="mi">165</span><span class="p">),</span> <span class="n">LR_data</span><span class="p">)</span>  <span class="c1"># 绘制回归直线</span>
<span class="n">plt</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">)</span>   <span class="c1"># 绘制散点图</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>&lt;matplotlib.collections.PathCollection at 0x11ff529d0&gt;
</pre></div>
</div>
<img alt="../_images/prediction_model_8_1.png" src="../_images/prediction_model_8_1.png" />
</div>
</div>
<p>我们常常用相关系数<span class="math notranslate nohighlight">\(R^2\)</span>描述线性拟合的效果，使用方法如下</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># 5. 计算R2</span>
<span class="n">lrModel</span><span class="o">.</span><span class="n">score</span><span class="p">(</span><span class="n">x</span><span class="p">,</span><span class="n">y</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>0.928187845952738
</pre></div>
</div>
</div>
</div>
<p>执行代码可以看到，模型的评分为<code class="docutils literal notranslate"><span class="pre">0.928</span></code>,是非常不错的一个评分，我们就可以使用这个模型进行未知数据的预测了。（评分等于相关系数<span class="math notranslate nohighlight">\(R^2\)</span>用于表示拟合得到的模型能解释因变量变化的百分比，<span class="math notranslate nohighlight">\(R^2\)</span>越接近于1，表示回归模型拟合效果越好，通常认为<span class="math notranslate nohighlight">\(R^2 &gt; 0.8\)</span> 就是比较满意的回归结果了）</p>
<p>假定两位新同学的身高分别是170cm和163cm，下面使用本文的模型预测他们的身高。</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># 6. 对新的数据进行预测</span>
<span class="n">lrModel</span><span class="o">.</span><span class="n">predict</span><span class="p">([[</span><span class="mi">170</span><span class="p">],[</span><span class="mi">163</span><span class="p">]])</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>array([106.21689217, 101.18142681])
</pre></div>
</div>
</div>
</div>
</div>
<div class="section" id="id6">
<h3><span class="section-number">3.2.2. </span>多元线性回归模型<a class="headerlink" href="#id6" title="Permalink to this headline">¶</a></h3>
<p>在回归分析中，如果有两个或两个以上的自变量，就称为多元回归。事实上，一种现象常常是与多个因素相联系的，由多个自变量的最优组合共同来预测或估计因变量，比只用一个自变量进行预测或估计更有效，更符合实际。</p>
<p>在实际经济问题中，一个变量往往受到多个变量的影响。例如，家庭消费支出，除了受家庭可支配收入的影响外，还受诸如家庭所有的财富、物价水平、金融机构存款利息等多种因素的影响，表现在线性回归模型中的解释变量有多个。这样的模型被称为<strong>多元线性回归模型（multivariable linear regression model）</strong></p>
<div class="math notranslate nohighlight">
\[
y=\beta_{0}+\beta_{1} x_{1}+\beta_{2} x_{2}+\cdots \beta_{m} x_{m}
\]</div>
<p>多元性回归模型的参数估计，同一元线性回归方程一样，也是在要求误差平方和最小的前提下，用最小二乘法求解参数。</p>
<div class="math notranslate nohighlight">
\[
\min \sum_{i=1}^{n} \varepsilon_{i}^{2}=\min \sum_{i=1}^{n}\left(y_{i}-\left(\beta_{0}+\beta_{1} x_{1i}+\beta_{2} x_{2i}+\cdots \beta_{m} x_{mi}\right)\right)^{2}
\]</div>
<p>同样地，这里我们暂时不关心回归系数的具体的推导过程，只需要知道如何用Python操作即可。我们通过一个SO2浓度预测的案例进行介绍。</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="nn">pd</span> <span class="c1"># 导入 pandas库 ，用于数据分析</span>
<span class="n">data</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="s1">&#39;../_static/lecture_specific/prediction_model/so2.csv&#39;</span><span class="p">)</span> <span class="c1"># 读入数据</span>
<span class="nb">print</span><span class="p">(</span><span class="n">data</span><span class="p">)</span> <span class="c1"># 显示数据</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>    SO2(ppm)    R    G    B    S    H
0          0  153  148  157  138   14
1          0  153  147  157  138   16
2          0  153  146  158  137   20
3          0  153  146  158  137   20
4          0  154  145  157  141   19
5         20  144  115  170  135   82
6         20  144  115  169  136   81
7         20  145  115  172  135   83
8         30  145  114  174  135   87
9         30  145  114  176  135   89
10        30  145  114  175  135   89
11        30  146  114  175  135   88
12        50  142   99  175  137  110
13        50  141   99  174  137  109
14        50  142   99  176  136  110
15        80  141   96  181  135  119
16        80  141   96  182  135  119
17        80  140   96  182  135  120
18       100  139   96  175  136  115
19       100  139   96  174  136  114
20       100  139   96  176  136  116
21       150  139   86  178  136  131
22       150  139   87  177  137  129
23       150  138   86  177  137  130
24       150  139   86  178  137  131
</pre></div>
</div>
</div>
</div>
<p>可以看到，这是一个<strong>五个变量</strong>的多元线性回归，我们先通过散点图来看一下<strong>各个变量单独与因变量的关系</strong>。</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">So2</span> <span class="o">=</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">20</span><span class="p">,</span> <span class="mi">20</span><span class="p">,</span> <span class="mi">20</span><span class="p">,</span> <span class="mi">30</span><span class="p">,</span> <span class="mi">30</span><span class="p">,</span> <span class="mi">30</span><span class="p">,</span> <span class="mi">30</span><span class="p">,</span> <span class="mi">50</span><span class="p">,</span> <span class="mi">50</span><span class="p">,</span> <span class="mi">50</span><span class="p">,</span> <span class="mi">80</span><span class="p">,</span> <span class="mi">80</span><span class="p">,</span> <span class="mi">80</span><span class="p">,</span> <span class="mi">100</span><span class="p">,</span> <span class="mi">100</span><span class="p">,</span> <span class="mi">100</span><span class="p">,</span> <span class="mi">150</span><span class="p">,</span> <span class="mi">150</span><span class="p">,</span> <span class="mi">150</span><span class="p">,</span> <span class="mi">150</span><span class="p">]</span>
<span class="n">R</span> <span class="o">=</span> <span class="p">[</span><span class="mi">153</span><span class="p">,</span> <span class="mi">153</span><span class="p">,</span> <span class="mi">153</span><span class="p">,</span> <span class="mi">153</span><span class="p">,</span> <span class="mi">154</span><span class="p">,</span> <span class="mi">144</span><span class="p">,</span> <span class="mi">144</span><span class="p">,</span> <span class="mi">145</span><span class="p">,</span> <span class="mi">145</span><span class="p">,</span> <span class="mi">145</span><span class="p">,</span> <span class="mi">145</span><span class="p">,</span> <span class="mi">146</span><span class="p">,</span> <span class="mi">142</span><span class="p">,</span> <span class="mi">141</span><span class="p">,</span> <span class="mi">142</span><span class="p">,</span> <span class="mi">141</span><span class="p">,</span> <span class="mi">141</span><span class="p">,</span> <span class="mi">140</span><span class="p">,</span> <span class="mi">139</span><span class="p">,</span> <span class="mi">139</span><span class="p">,</span> <span class="mi">139</span><span class="p">,</span> <span class="mi">139</span><span class="p">,</span> <span class="mi">139</span><span class="p">,</span> <span class="mi">138</span><span class="p">,</span> <span class="mi">139</span><span class="p">]</span>
<span class="n">G</span> <span class="o">=</span> <span class="p">[</span><span class="mi">148</span><span class="p">,</span> <span class="mi">147</span><span class="p">,</span> <span class="mi">146</span><span class="p">,</span> <span class="mi">146</span><span class="p">,</span> <span class="mi">145</span><span class="p">,</span> <span class="mi">115</span><span class="p">,</span> <span class="mi">115</span><span class="p">,</span> <span class="mi">115</span><span class="p">,</span> <span class="mi">114</span><span class="p">,</span> <span class="mi">114</span><span class="p">,</span> <span class="mi">114</span><span class="p">,</span> <span class="mi">114</span><span class="p">,</span> <span class="mi">99</span><span class="p">,</span> <span class="mi">99</span><span class="p">,</span> <span class="mi">99</span><span class="p">,</span> <span class="mi">96</span><span class="p">,</span> <span class="mi">96</span><span class="p">,</span> <span class="mi">96</span><span class="p">,</span> <span class="mi">96</span><span class="p">,</span> <span class="mi">96</span><span class="p">,</span> <span class="mi">96</span><span class="p">,</span> <span class="mi">86</span><span class="p">,</span> <span class="mi">87</span><span class="p">,</span> <span class="mi">86</span><span class="p">,</span> <span class="mi">86</span><span class="p">]</span>
<span class="n">B</span> <span class="o">=</span> <span class="p">[</span><span class="mi">157</span><span class="p">,</span> <span class="mi">157</span><span class="p">,</span> <span class="mi">158</span><span class="p">,</span> <span class="mi">158</span><span class="p">,</span> <span class="mi">157</span><span class="p">,</span> <span class="mi">170</span><span class="p">,</span> <span class="mi">169</span><span class="p">,</span> <span class="mi">172</span><span class="p">,</span> <span class="mi">174</span><span class="p">,</span> <span class="mi">176</span><span class="p">,</span> <span class="mi">175</span><span class="p">,</span> <span class="mi">175</span><span class="p">,</span> <span class="mi">175</span><span class="p">,</span> <span class="mi">174</span><span class="p">,</span> <span class="mi">176</span><span class="p">,</span> <span class="mi">181</span><span class="p">,</span> <span class="mi">182</span><span class="p">,</span> <span class="mi">182</span><span class="p">,</span> <span class="mi">175</span><span class="p">,</span> <span class="mi">174</span><span class="p">,</span> <span class="mi">176</span><span class="p">,</span> <span class="mi">178</span><span class="p">,</span> <span class="mi">177</span><span class="p">,</span> <span class="mi">177</span><span class="p">,</span> <span class="mi">178</span><span class="p">]</span>
<span class="n">S</span> <span class="o">=</span> <span class="p">[</span><span class="mi">138</span><span class="p">,</span> <span class="mi">138</span><span class="p">,</span> <span class="mi">137</span><span class="p">,</span> <span class="mi">137</span><span class="p">,</span> <span class="mi">141</span><span class="p">,</span> <span class="mi">135</span><span class="p">,</span> <span class="mi">136</span><span class="p">,</span> <span class="mi">135</span><span class="p">,</span> <span class="mi">135</span><span class="p">,</span> <span class="mi">135</span><span class="p">,</span> <span class="mi">135</span><span class="p">,</span> <span class="mi">135</span><span class="p">,</span> <span class="mi">137</span><span class="p">,</span> <span class="mi">137</span><span class="p">,</span> <span class="mi">136</span><span class="p">,</span> <span class="mi">135</span><span class="p">,</span> <span class="mi">135</span><span class="p">,</span> <span class="mi">135</span><span class="p">,</span> <span class="mi">136</span><span class="p">,</span> <span class="mi">136</span><span class="p">,</span> <span class="mi">136</span><span class="p">,</span> <span class="mi">136</span><span class="p">,</span> <span class="mi">137</span><span class="p">,</span> <span class="mi">137</span><span class="p">,</span> <span class="mi">137</span><span class="p">]</span>
<span class="n">H</span> <span class="o">=</span> <span class="p">[</span><span class="mi">14</span><span class="p">,</span> <span class="mi">16</span><span class="p">,</span> <span class="mi">20</span><span class="p">,</span> <span class="mi">20</span><span class="p">,</span> <span class="mi">19</span><span class="p">,</span> <span class="mi">82</span><span class="p">,</span> <span class="mi">81</span><span class="p">,</span> <span class="mi">83</span><span class="p">,</span> <span class="mi">87</span><span class="p">,</span> <span class="mi">89</span><span class="p">,</span> <span class="mi">89</span><span class="p">,</span> <span class="mi">88</span><span class="p">,</span> <span class="mi">110</span><span class="p">,</span> <span class="mi">109</span><span class="p">,</span> <span class="mi">110</span><span class="p">,</span> <span class="mi">119</span><span class="p">,</span> <span class="mi">119</span><span class="p">,</span> <span class="mi">120</span><span class="p">,</span> <span class="mi">115</span><span class="p">,</span> <span class="mi">114</span><span class="p">,</span> <span class="mi">116</span><span class="p">,</span> <span class="mi">131</span><span class="p">,</span> <span class="mi">129</span><span class="p">,</span> <span class="mi">130</span><span class="p">,</span> <span class="mi">131</span><span class="p">]</span>


<span class="kn">import</span> <span class="nn">seaborn</span> <span class="k">as</span> <span class="nn">sns</span>  <span class="c1"># 导入 seaborn库 ，用于数据可视化</span>
<span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">plt</span>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="n">colors</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;r&#39;</span><span class="p">,</span> <span class="s1">&#39;g&#39;</span><span class="p">,</span> <span class="s1">&#39;b&#39;</span><span class="p">,</span> <span class="s1">&#39;m&#39;</span><span class="p">,</span> <span class="s1">&#39;black&#39;</span><span class="p">]</span>  <span class="c1"># 指定每个绘图的颜色</span>
<span class="n">xlist</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;R&#39;</span><span class="p">,</span> <span class="s1">&#39;G&#39;</span><span class="p">,</span> <span class="s1">&#39;B&#39;</span><span class="p">,</span> <span class="s1">&#39;S&#39;</span><span class="p">,</span> <span class="s1">&#39;H&#39;</span><span class="p">]</span>  <span class="c1"># 指定每个绘图的变量名</span>
<span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">20</span><span class="p">,</span> <span class="mi">13</span><span class="p">))</span>  <span class="c1"># 指定图片大小</span>

<span class="c1"># 绘制R子图</span>
<span class="n">plt</span><span class="o">.</span><span class="n">subplot</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>  
<span class="n">sns</span><span class="o">.</span><span class="n">regplot</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="n">R</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="n">So2</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;r&#39;</span><span class="p">)</span>  <span class="c1"># 绘制带有回归线和置信区间的线性回归图</span>
<span class="n">title_text</span> <span class="o">=</span> <span class="s1">&#39;R = </span><span class="si">{:.2f}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">corrcoef</span><span class="p">(</span><span class="n">R</span><span class="p">,</span><span class="n">So2</span><span class="p">)[</span><span class="mi">1</span><span class="p">][</span><span class="mi">0</span><span class="p">],)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="n">title_text</span><span class="p">)</span>  <span class="c1"># 添加子图标题</span>

<span class="c1"># 绘制R子图</span>
<span class="n">plt</span><span class="o">.</span><span class="n">subplot</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span>  
<span class="n">sns</span><span class="o">.</span><span class="n">regplot</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="n">G</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="n">So2</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;g&#39;</span><span class="p">)</span>  <span class="c1"># 绘制带有回归线和置信区间的线性回归图</span>
<span class="n">title_text</span> <span class="o">=</span> <span class="s1">&#39;G = </span><span class="si">{:.2f}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">corrcoef</span><span class="p">(</span><span class="n">G</span><span class="p">,</span><span class="n">So2</span><span class="p">)[</span><span class="mi">1</span><span class="p">][</span><span class="mi">0</span><span class="p">],)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="n">title_text</span><span class="p">)</span>  <span class="c1"># 添加子图标题</span>


<span class="c1"># 绘制B子图</span>
<span class="n">plt</span><span class="o">.</span><span class="n">subplot</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">3</span><span class="p">)</span>  
<span class="n">sns</span><span class="o">.</span><span class="n">regplot</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="n">B</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="n">So2</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;b&#39;</span><span class="p">)</span>  <span class="c1"># 绘制带有回归线和置信区间的线性回归图</span>
<span class="n">title_text</span> <span class="o">=</span> <span class="s1">&#39;B = </span><span class="si">{:.2f}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">corrcoef</span><span class="p">(</span><span class="n">B</span><span class="p">,</span><span class="n">So2</span><span class="p">)[</span><span class="mi">1</span><span class="p">][</span><span class="mi">0</span><span class="p">],)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="n">title_text</span><span class="p">)</span>  <span class="c1"># 添加子图标题</span>


<span class="c1"># 绘制S子图</span>
<span class="n">plt</span><span class="o">.</span><span class="n">subplot</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">4</span><span class="p">)</span>  
<span class="n">sns</span><span class="o">.</span><span class="n">regplot</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="n">S</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="n">So2</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;m&#39;</span><span class="p">)</span>  <span class="c1"># 绘制带有回归线和置信区间的线性回归图</span>
<span class="n">title_text</span> <span class="o">=</span> <span class="s1">&#39;S = </span><span class="si">{:.2f}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">corrcoef</span><span class="p">(</span><span class="n">S</span><span class="p">,</span><span class="n">So2</span><span class="p">)[</span><span class="mi">1</span><span class="p">][</span><span class="mi">0</span><span class="p">],)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="n">title_text</span><span class="p">)</span>  <span class="c1"># 添加子图标题</span>



<span class="c1"># 绘制B子图</span>
<span class="n">plt</span><span class="o">.</span><span class="n">subplot</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">5</span><span class="p">)</span>  
<span class="n">sns</span><span class="o">.</span><span class="n">regplot</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="n">H</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="n">So2</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;black&#39;</span><span class="p">)</span>  <span class="c1"># 绘制带有回归线和置信区间的线性回归图</span>
<span class="n">title_text</span> <span class="o">=</span> <span class="s1">&#39;H = </span><span class="si">{:.2f}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">corrcoef</span><span class="p">(</span><span class="n">H</span><span class="p">,</span><span class="n">So2</span><span class="p">)[</span><span class="mi">1</span><span class="p">][</span><span class="mi">0</span><span class="p">],)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="n">title_text</span><span class="p">)</span>  <span class="c1"># 添加子图标题</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Text(0.5, 1.0, &#39;H = 0.83&#39;)
</pre></div>
</div>
<img alt="../_images/prediction_model_18_1.png" src="../_images/prediction_model_18_1.png" />
</div>
</div>
<p>可以看到，除了第四个变量<span class="math notranslate nohighlight">\(S\)</span>以外，每一个变量基本上都和因变量有线性关系，因此我们可以删去<span class="math notranslate nohighlight">\(S\)</span>，进行多元线性回归。</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">sklearn.linear_model</span> <span class="kn">import</span> <span class="n">LinearRegression</span>  <span class="c1"># 导入线性回归函数LinearRegression</span>
<span class="n">lrModel</span> <span class="o">=</span> <span class="n">LinearRegression</span><span class="p">()</span>     <span class="c1"># 初始化回归模型</span>
<span class="n">lrModel</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">R</span><span class="p">,</span><span class="n">G</span><span class="p">,</span><span class="n">B</span><span class="p">,</span><span class="n">H</span><span class="p">])</span><span class="o">.</span><span class="n">T</span><span class="p">,</span><span class="n">So2</span><span class="p">)</span>  <span class="c1"># 输入需要回归的数据</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;截距为：&#39;</span><span class="p">,</span> <span class="n">lrModel</span><span class="o">.</span><span class="n">intercept_</span><span class="p">)</span>  <span class="c1"># 输出截距</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;系数为：&#39;</span><span class="p">,</span> <span class="n">lrModel</span><span class="o">.</span><span class="n">coef_</span><span class="p">)</span>    <span class="c1"># 输出系数</span>
<span class="n">score</span> <span class="o">=</span> <span class="n">lrModel</span><span class="o">.</span><span class="n">score</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">R</span><span class="p">,</span><span class="n">G</span><span class="p">,</span><span class="n">B</span><span class="p">,</span><span class="n">H</span><span class="p">])</span><span class="o">.</span><span class="n">T</span><span class="p">,</span> <span class="n">So2</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;R2为：&#39;</span><span class="p">,</span> <span class="n">score</span><span class="p">)</span>    <span class="c1"># 输出相关系数R2</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>截距为： 2044.021593204974
系数为： [ -1.38977229 -17.5022507    5.68341432  -9.34216398]
R2为： 0.8961318172850157
</pre></div>
</div>
</div>
</div>
</div>
</div>
<div class="section" id="id7">
<h2><span class="section-number">3.3. </span>非线性拟合<a class="headerlink" href="#id7" title="Permalink to this headline">¶</a></h2>
<div class="section" id="polynomial-regression">
<h3><span class="section-number">3.3.1. </span>多项式拟合（Polynomial regression）<a class="headerlink" href="#polynomial-regression" title="Permalink to this headline">¶</a></h3>
<p>尽管上述的线性模型已经能够求解许多实际问题，然而生活中的很多系统的增长趋势往往是非线性的，这时候我们就需要用到非线性拟合。</p>
<p>对于非线性回归问题而言，最简单也是最常见的方法就是<strong>多项式回归</strong>。多项式（Polynomial）是代数学中的基础概念，是由称为未知数的变量和称为系数的常量通过有限次加法、加减法、乘法以及自然数幂次的乘方运算得到的代数表达式。多项式是整式的一种。未知数只有一个的多项式称为一元多项式；例如<span class="math notranslate nohighlight">\(x^{2}-3 x+4\)</span>就是一个一元多项式。未知数不止一个的多项式称为多元多项式，例如<span class="math notranslate nohighlight">\(x^{3}-2 x y z^{2}+2 y z+1\)</span>就是一个三元多项式。</p>
<p>首先，我们通过一组示例数据来认识多项式回归，示例数据一共有 10 组，分别对应着横坐标和纵坐标。接下来，通过 Matplotlib 绘制数据，查看其变化趋势。</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># 加载示例数据</span>
<span class="n">x</span> <span class="o">=</span> <span class="p">[</span><span class="mi">4</span><span class="p">,</span> <span class="mi">8</span><span class="p">,</span> <span class="mi">12</span><span class="p">,</span> <span class="mi">25</span><span class="p">,</span> <span class="mi">32</span><span class="p">,</span> <span class="mi">43</span><span class="p">,</span> <span class="mi">58</span><span class="p">,</span> <span class="mi">63</span><span class="p">,</span> <span class="mi">69</span><span class="p">,</span> <span class="mi">79</span><span class="p">]</span> <span class="c1"># 输入x</span>
<span class="n">y</span> <span class="o">=</span> <span class="p">[</span><span class="mi">20</span><span class="p">,</span> <span class="mi">33</span><span class="p">,</span> <span class="mi">50</span><span class="p">,</span> <span class="mi">56</span><span class="p">,</span> <span class="mi">42</span><span class="p">,</span> <span class="mi">31</span><span class="p">,</span> <span class="mi">33</span><span class="p">,</span> <span class="mi">46</span><span class="p">,</span> <span class="mi">65</span><span class="p">,</span> <span class="mi">75</span><span class="p">]</span>  <span class="c1"># 输入y </span>
<span class="n">plt</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">)</span>  <span class="c1"># 绘制散点图</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>&lt;matplotlib.collections.PathCollection at 0x121a3a410&gt;
</pre></div>
</div>
<img alt="../_images/prediction_model_23_1.png" src="../_images/prediction_model_23_1.png" />
</div>
</div>
<p>接下来，通过多项式来拟合上面的散点数据。一个标准的一元高阶多项式函数如下所示：</p>
<div class="math notranslate nohighlight">
\[
y(x, w)=w_{0}+w_{1} x+w_{2} x^{2}+\ldots+w_{m} x^{m}=\sum_{j=0}^{m} w_{j} x^{j}
\]</div>
<p>其中，<span class="math notranslate nohighlight">\(m\)</span>表示多项式的阶数，<span class="math notranslate nohighlight">\(x^j\)</span>表示<span class="math notranslate nohighlight">\(x\)</span>的<span class="math notranslate nohighlight">\(j\)</span>次幂，<span class="math notranslate nohighlight">\(w\)</span>则代表该多项式的系数。当我们使用上面的多项式去拟合散点时，需要确定两个要素，分别是：</p>
<ul class="simple">
<li><p>多项式系数<span class="math notranslate nohighlight">\(w\)</span></p></li>
<li><p>多项式阶数<span class="math notranslate nohighlight">\(m\)</span></p></li>
</ul>
<p>这也是多项式的两个基本要素。</p>
<p>如果通过手动指定多项式阶数<span class="math notranslate nohighlight">\(m\)</span>的大小，那么就只需要确定多项式系数<span class="math notranslate nohighlight">\(w\)</span>的值是多少。例如，这里首先指定<span class="math notranslate nohighlight">\(m=2\)</span>,多项式就变成了：</p>
<div class="math notranslate nohighlight">
\[
y(x, w)=w_{0}+w_{1} x+w_{2} x^{2}=\sum_{j=0}^{2} w_{j} x^{j}
\]</div>
<p>当我们确定<span class="math notranslate nohighlight">\(w\)</span>的值的大小时，就回到了前面线性回归中学习到的内容，具体来说，就是最小化残差平方和（最小二乘法）。</p>
<p>我们先尝试使用二次多项式拟合。</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># 加载示例数据</span>
<span class="n">x</span> <span class="o">=</span> <span class="p">[</span><span class="mi">4</span><span class="p">,</span> <span class="mi">8</span><span class="p">,</span> <span class="mi">12</span><span class="p">,</span> <span class="mi">25</span><span class="p">,</span> <span class="mi">32</span><span class="p">,</span> <span class="mi">43</span><span class="p">,</span> <span class="mi">58</span><span class="p">,</span> <span class="mi">63</span><span class="p">,</span> <span class="mi">69</span><span class="p">,</span> <span class="mi">79</span><span class="p">]</span>
<span class="n">y</span> <span class="o">=</span> <span class="p">[</span><span class="mi">20</span><span class="p">,</span> <span class="mi">33</span><span class="p">,</span> <span class="mi">50</span><span class="p">,</span> <span class="mi">56</span><span class="p">,</span> <span class="mi">42</span><span class="p">,</span> <span class="mi">31</span><span class="p">,</span> <span class="mi">33</span><span class="p">,</span> <span class="mi">46</span><span class="p">,</span> <span class="mi">65</span><span class="p">,</span> <span class="mi">75</span><span class="p">]</span>
<span class="kn">from</span> <span class="nn">scipy.optimize</span> <span class="kn">import</span> <span class="n">curve_fit</span>  <span class="c1"># 导入非线性拟合函数curve_fit</span>

<span class="c1"># 定义需要拟合的函数形式，这里使用二次函数的一般式 y = ax^2 + bx + c</span>
<span class="k">def</span> <span class="nf">f2</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">,</span> <span class="n">c</span><span class="p">):</span>
    <span class="k">return</span> <span class="n">a</span> <span class="o">*</span> <span class="n">x</span><span class="o">**</span><span class="mi">2</span> <span class="o">+</span> <span class="n">b</span><span class="o">*</span><span class="n">x</span> <span class="o">+</span> <span class="n">c</span>


<span class="n">plt</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">)</span>  <span class="c1"># 绘制散点图</span>
<span class="n">popt</span><span class="p">,</span> <span class="n">pcov</span> <span class="o">=</span> <span class="n">curve_fit</span><span class="p">(</span><span class="n">f2</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">)</span>    <span class="c1"># 执行非线性拟合</span>
<span class="c1"># popt数组中，三个值分别是待求参数a,b,c</span>
<span class="n">y1</span> <span class="o">=</span> <span class="p">[</span><span class="n">f2</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="n">popt</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">popt</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">popt</span><span class="p">[</span><span class="mi">2</span><span class="p">])</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">x</span><span class="p">]</span>   <span class="c1"># 计算得到拟合曲线上的一系列点</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y1</span><span class="p">,</span> <span class="s1">&#39;r&#39;</span><span class="p">)</span>   <span class="c1"># 绘制拟合曲线</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>[&lt;matplotlib.lines.Line2D at 0x1241be590&gt;]
</pre></div>
</div>
<img alt="../_images/prediction_model_26_1.png" src="../_images/prediction_model_26_1.png" />
</div>
</div>
<p>可以看到，其效果并不好，增大次数试一下？</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># f3为三次多项式</span>
<span class="k">def</span> <span class="nf">f3</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">,</span> <span class="n">c</span><span class="p">,</span><span class="n">d</span><span class="p">):</span>  
    <span class="k">return</span> <span class="n">a</span> <span class="o">*</span> <span class="n">x</span><span class="o">**</span><span class="mi">3</span> <span class="o">+</span> <span class="n">b</span><span class="o">*</span><span class="n">x</span><span class="o">**</span><span class="mi">2</span> <span class="o">+</span><span class="n">c</span> <span class="o">*</span><span class="n">x</span> <span class="o">+</span><span class="n">d</span>
<span class="c1"># f4为四次多项式</span>
<span class="k">def</span> <span class="nf">f4</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">,</span> <span class="n">c</span><span class="p">,</span><span class="n">d</span><span class="p">,</span><span class="n">e</span><span class="p">):</span>  
    <span class="k">return</span> <span class="n">a</span> <span class="o">*</span> <span class="n">x</span><span class="o">**</span><span class="mi">4</span> <span class="o">+</span> <span class="n">b</span><span class="o">*</span><span class="n">x</span><span class="o">**</span><span class="mi">3</span> <span class="o">+</span><span class="n">c</span> <span class="o">*</span><span class="n">x</span><span class="o">**</span><span class="mi">2</span> <span class="o">+</span><span class="n">d</span><span class="o">*</span><span class="n">x</span> <span class="o">+</span> <span class="n">e</span>
<span class="c1"># f5为五次多项式</span>
<span class="k">def</span> <span class="nf">f5</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">,</span> <span class="n">c</span><span class="p">,</span><span class="n">d</span><span class="p">,</span><span class="n">e</span><span class="p">,</span><span class="n">f</span><span class="p">):</span>  
    <span class="k">return</span> <span class="n">a</span> <span class="o">*</span> <span class="n">x</span><span class="o">**</span><span class="mi">5</span> <span class="o">+</span> <span class="n">b</span><span class="o">*</span><span class="n">x</span><span class="o">**</span><span class="mi">4</span> <span class="o">+</span><span class="n">c</span> <span class="o">*</span><span class="n">x</span><span class="o">**</span><span class="mi">3</span> <span class="o">+</span><span class="n">d</span><span class="o">*</span><span class="n">x</span><span class="o">**</span><span class="mi">2</span> <span class="o">+</span> <span class="n">e</span><span class="o">*</span><span class="n">x</span> <span class="o">+</span><span class="n">f</span>

<span class="c1"># 定义方差计算函数</span>
<span class="k">def</span> <span class="nf">error</span><span class="p">(</span><span class="n">y1</span><span class="p">,</span><span class="n">y2</span><span class="p">):</span>
    <span class="n">a</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">y1</span><span class="p">)</span>
    <span class="n">b</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">y2</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="n">a</span><span class="o">-</span><span class="n">b</span><span class="p">,</span><span class="n">a</span><span class="o">-</span><span class="n">b</span><span class="p">)</span>
    

<span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span> <span class="o">=</span> <span class="p">(</span><span class="mi">10</span><span class="p">,</span><span class="mi">10</span><span class="p">))</span> <span class="c1"># 定义图片大小</span>
<span class="n">plt</span><span class="o">.</span><span class="n">subplot</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="mi">1</span><span class="p">)</span> <span class="c1"># 开始绘制第1张子图</span>
<span class="n">plt</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">)</span>  <span class="c1"># 绘制（x,y）的散点图</span>
<span class="n">popt</span><span class="p">,</span> <span class="n">pcov</span> <span class="o">=</span> <span class="n">curve_fit</span><span class="p">(</span><span class="n">f2</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">)</span>    <span class="c1"># 执行2次多项式拟合</span>
<span class="c1">#popt数组中，三个值分别是待求参数a,b,c  </span>
<span class="n">y1</span> <span class="o">=</span> <span class="p">[</span><span class="n">f2</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="n">popt</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span><span class="n">popt</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span><span class="n">popt</span><span class="p">[</span><span class="mi">2</span><span class="p">])</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">x</span><span class="p">]</span>  <span class="c1"># 得到拟合曲线上的一系列点</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">x</span><span class="p">,</span><span class="n">y1</span><span class="p">,</span><span class="s1">&#39;r--&#39;</span><span class="p">)</span>   <span class="c1"># 绘制拟合曲线</span>
<span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">error</span><span class="p">(</span><span class="n">y</span><span class="p">,</span><span class="n">y1</span><span class="p">)))</span> <span class="c1"># 计算方差，并作为图片的标题</span>

<span class="n">plt</span><span class="o">.</span><span class="n">subplot</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="mi">2</span><span class="p">)</span> <span class="c1"># 开始绘制第2张子图</span>
<span class="n">plt</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">)</span> <span class="c1"># 绘制（x,y）的散点图</span>
<span class="n">popt</span><span class="p">,</span> <span class="n">pcov</span> <span class="o">=</span> <span class="n">curve_fit</span><span class="p">(</span><span class="n">f3</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">)</span>   <span class="c1"># 执行3次多项式拟合</span>
<span class="c1">#popt数组中，三个值分别是待求参数a,b,c,d  </span>
<span class="n">y1</span> <span class="o">=</span> <span class="p">[</span><span class="n">f3</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="n">popt</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span><span class="n">popt</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span><span class="n">popt</span><span class="p">[</span><span class="mi">2</span><span class="p">],</span><span class="n">popt</span><span class="p">[</span><span class="mi">3</span><span class="p">])</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">x</span><span class="p">]</span>    <span class="c1"># 得到拟合曲线上的一系列点</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">x</span><span class="p">,</span><span class="n">y1</span><span class="p">,</span><span class="s1">&#39;r--&#39;</span><span class="p">)</span>   <span class="c1"># 绘制拟合曲线</span>
<span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">error</span><span class="p">(</span><span class="n">y</span><span class="p">,</span><span class="n">y1</span><span class="p">)))</span> <span class="c1"># 计算方差，并作为图片的标题</span>


<span class="n">plt</span><span class="o">.</span><span class="n">subplot</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="mi">3</span><span class="p">)</span> <span class="c1"># 开始绘制第3张子图</span>
<span class="n">plt</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">)</span>
<span class="n">popt</span><span class="p">,</span> <span class="n">pcov</span> <span class="o">=</span> <span class="n">curve_fit</span><span class="p">(</span><span class="n">f4</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">)</span>  
<span class="n">y1</span> <span class="o">=</span> <span class="p">[</span><span class="n">f4</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="n">popt</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span><span class="n">popt</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span><span class="n">popt</span><span class="p">[</span><span class="mi">2</span><span class="p">],</span><span class="n">popt</span><span class="p">[</span><span class="mi">3</span><span class="p">],</span><span class="n">popt</span><span class="p">[</span><span class="mi">4</span><span class="p">])</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">x</span><span class="p">]</span>  
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">x</span><span class="p">,</span><span class="n">y1</span><span class="p">,</span><span class="s1">&#39;r--&#39;</span><span class="p">)</span>  
<span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">error</span><span class="p">(</span><span class="n">y</span><span class="p">,</span><span class="n">y1</span><span class="p">)))</span>

<span class="n">plt</span><span class="o">.</span><span class="n">subplot</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="mi">4</span><span class="p">)</span> <span class="c1"># 开始绘制第4张子图</span>
<span class="n">plt</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">)</span>
<span class="n">popt</span><span class="p">,</span> <span class="n">pcov</span> <span class="o">=</span> <span class="n">curve_fit</span><span class="p">(</span><span class="n">f5</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">)</span>  
<span class="n">y1</span> <span class="o">=</span> <span class="p">[</span><span class="n">f5</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="n">popt</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span><span class="n">popt</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span><span class="n">popt</span><span class="p">[</span><span class="mi">2</span><span class="p">],</span><span class="n">popt</span><span class="p">[</span><span class="mi">3</span><span class="p">],</span><span class="n">popt</span><span class="p">[</span><span class="mi">4</span><span class="p">],</span><span class="n">popt</span><span class="p">[</span><span class="mi">5</span><span class="p">])</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">x</span><span class="p">]</span>  
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">x</span><span class="p">,</span><span class="n">y1</span><span class="p">,</span><span class="s1">&#39;r--&#39;</span><span class="p">)</span>  
<span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">error</span><span class="p">(</span><span class="n">y</span><span class="p">,</span><span class="n">y1</span><span class="p">)))</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Text(0.5, 1.0, &#39;38.052046270695655&#39;)
</pre></div>
</div>
<img alt="../_images/prediction_model_28_1.png" src="../_images/prediction_model_28_1.png" />
</div>
</div>
<p>**思考：**一定是越高的阶次越好吗？</p>
<p><img alt="Image Name" src="https://cdn.kesci.com/upload/image/q33loqharh.png?imageView2/0/w/960/h/960" /></p>
<p>注意：兼顾拟合误差和预测误差。防止<strong>过拟合（overfit）<strong>和</strong>欠拟合（underfit）</strong>。</p>
</div>
<div class="section" id="id8">
<h3><span class="section-number">3.3.2. </span>一元其他非线性函数拟合<a class="headerlink" href="#id8" title="Permalink to this headline">¶</a></h3>
<p>这里我们举一个指数拟合的例子与二次函数拟合进行对比。实际上，使用本课程讲到的方法，可以进行任意形式的函数拟合。</p>
<div class="math notranslate nohighlight">
\[
f_1(x) = x^a + b
\]</div>
<div class="math notranslate nohighlight">
\[
f_2(x) = ax^2 + b
\]</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># 定义f1</span>
<span class="k">def</span> <span class="nf">f1</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">):</span>  
    <span class="k">return</span> <span class="n">x</span><span class="o">**</span><span class="n">a</span> <span class="o">+</span> <span class="n">b</span>  
<span class="c1"># 定义f2</span>
<span class="k">def</span> <span class="nf">f2</span><span class="p">(</span><span class="n">x</span><span class="p">,</span><span class="n">a</span><span class="p">,</span><span class="n">b</span><span class="p">):</span>
    <span class="k">return</span> <span class="n">a</span><span class="o">*</span><span class="n">x</span><span class="o">**</span><span class="mi">2</span> <span class="o">+</span> <span class="n">b</span>
<span class="c1"># 随机生成数据并绘制折线图</span>
<span class="n">xdata</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">50</span><span class="p">)</span>  
<span class="n">y</span> <span class="o">=</span> <span class="n">f1</span><span class="p">(</span><span class="n">xdata</span><span class="p">,</span> <span class="mf">2.5</span><span class="p">,</span> <span class="mf">1.3</span><span class="p">)</span>  
<span class="n">ydata</span> <span class="o">=</span> <span class="n">y</span> <span class="o">+</span> <span class="mi">4</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">normal</span><span class="p">(</span><span class="n">size</span><span class="o">=</span><span class="nb">len</span><span class="p">(</span><span class="n">xdata</span><span class="p">))</span>  
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">xdata</span><span class="p">,</span><span class="n">ydata</span><span class="p">,</span><span class="s1">&#39;b-&#39;</span><span class="p">)</span> 

<span class="c1"># 开始拟合</span>
<span class="n">popt1</span><span class="p">,</span> <span class="n">pcov1</span> <span class="o">=</span> <span class="n">curve_fit</span><span class="p">(</span><span class="n">f1</span><span class="p">,</span> <span class="n">xdata</span><span class="p">,</span> <span class="n">ydata</span><span class="p">)</span>   <span class="c1"># 使用f1进行拟合</span>
<span class="n">popt2</span><span class="p">,</span> <span class="n">pcov2</span> <span class="o">=</span> <span class="n">curve_fit</span><span class="p">(</span><span class="n">f2</span><span class="p">,</span> <span class="n">xdata</span><span class="p">,</span> <span class="n">ydata</span><span class="p">)</span>    <span class="c1"># 使用f2进行拟合</span>

<span class="n">y1</span> <span class="o">=</span> <span class="p">[</span><span class="n">f1</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="n">popt1</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span><span class="n">popt1</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">xdata</span><span class="p">]</span>
<span class="n">y2</span> <span class="o">=</span> <span class="p">[</span><span class="n">f2</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="n">popt2</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span><span class="n">popt2</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">xdata</span><span class="p">]</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">xdata</span><span class="p">,</span><span class="n">y1</span><span class="p">,</span><span class="s1">&#39;--&#39;</span><span class="p">,</span><span class="n">label</span> <span class="o">=</span> <span class="s1">&#39;exp&#39;</span><span class="p">)</span>  
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">xdata</span><span class="p">,</span><span class="n">y2</span><span class="p">,</span><span class="s1">&#39;--&#39;</span><span class="p">,</span><span class="n">label</span> <span class="o">=</span> <span class="s1">&#39;para&#39;</span><span class="p">)</span> 
<span class="n">plt</span><span class="o">.</span><span class="n">legend</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>&lt;matplotlib.legend.Legend at 0x12472f7d0&gt;
</pre></div>
</div>
<img alt="../_images/prediction_model_34_1.png" src="../_images/prediction_model_34_1.png" />
</div>
</div>
</div>
</div>
<div class="section" id="id9">
<h2><span class="section-number">3.4. </span>时间序列方法<a class="headerlink" href="#id9" title="Permalink to this headline">¶</a></h2>
<div class="section" id="id10">
<h3><span class="section-number">3.4.1. </span>移动平均法<a class="headerlink" href="#id10" title="Permalink to this headline">¶</a></h3>
<p>移动平均法是根据时间序列资料逐渐推移，依次计算包含一定项数的时序平均数，以反映长期趋势的方法。当时间序列的数值由于受周期变动和不规则变动的影响，起伏较大，不易显示出发展趋势时，可用移动平均法，消除这些因素的影响，分析、预测序列的长期趋势。移动平均法有<strong>简单移动平均法，加权移动平均法，趋势移动平均法</strong>等。</p>
<div class="section" id="id11">
<h4><span class="section-number">3.4.1.1. </span>简单移动平均法<a class="headerlink" href="#id11" title="Permalink to this headline">¶</a></h4>
<p>当预测目标的基本趋势是在某一水平上下波动时，可用一次简单移动平均方法 (Simple Moving Average Method) 建立预测模型。设观测序列为<span class="math notranslate nohighlight">\(y_{1}, \cdots, y_{T}\)</span>,取移动平均的项数 <span class="math notranslate nohighlight">\(N &lt; T\)</span>,</p>
<div class="math notranslate nohighlight">
\[
\hat{y}_{t+1}=\frac{1}{N}\left(\hat{y}_{t}+\cdots+\hat{y}_{t-N+1}\right), t=N, N+1, \cdots,
\]</div>
<p>即：最近<span class="math notranslate nohighlight">\(N\)</span>期序列值的平均值作为未来各期的预测结果。</p>
<p>一般<span class="math notranslate nohighlight">\(N\)</span>取值范围：<span class="math notranslate nohighlight">\(5 \leq N \leq 200\)</span>。当历史序列的基本趋势变化不大且序列中随机变动成分较多时，<span class="math notranslate nohighlight">\(N\)</span> 的取值应较大一些。否则<span class="math notranslate nohighlight">\(N\)</span>的取值应小一些。在有确定的季节变动周期的资料中，移动平均的项数应取周期长度。选择最佳<span class="math notranslate nohighlight">\(N\)</span>值的一个有效方法是，比较若干模型的预测误差。预测标准误差最小者为好。</p>
<div class="admonition- admonition">
<p class="admonition-title">例</p>
<p>某企业1-11月份的销售收入时间序列如下表所示。试用一次简单移动平均预测其12月份的销售收入。</p>
<table class="colwidths-auto table">
<thead>
<tr class="row-odd"><th class="head"><p>月份</p></th>
<th class="head"><p>1</p></th>
<th class="head"><p>2</p></th>
<th class="head"><p>3</p></th>
<th class="head"><p>4</p></th>
<th class="head"><p>5</p></th>
<th class="head"><p>6</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>销售收入</p></td>
<td><p>533.8</p></td>
<td><p>574.6</p></td>
<td><p>606.9</p></td>
<td><p>649.8</p></td>
<td><p>705.1</p></td>
<td><p>772.0</p></td>
</tr>
<tr class="row-odd"><td><p>月份</p></td>
<td><p>7</p></td>
<td><p>8</p></td>
<td><p>9</p></td>
<td><p>10</p></td>
<td><p>11</p></td>
<td><p></p></td>
</tr>
<tr class="row-even"><td><p>销售收入</p></td>
<td><p>816.4</p></td>
<td><p>892.7</p></td>
<td><p>963.9</p></td>
<td><p>1015.1</p></td>
<td><p>1102.7</p></td>
<td><p></p></td>
</tr>
</tbody>
</table>
</div>
<p><strong>解</strong> ：分别取<span class="math notranslate nohighlight">\(N=4,N=5\)</span>的预测公式</p>
<div class="math notranslate nohighlight">
\[\begin{split}
\begin{aligned}
&amp;\hat{y}_{t+1}^{(1)}=\frac{y_{t}+y_{t-1}+y_{t-2}+y_{t-3}}{4}, \quad t=4,5, \cdots, 11\\
&amp;\hat{y}_{t+1}^{(1)}=\frac{y_{t}+y_{t-1}+y_{t-2}+y_{t-3}+y_{t-4}}{5}, \quad t=5, \cdots, 11
\end{aligned}
\end{split}\]</div>
<p>当<span class="math notranslate nohighlight">\(N=4\)</span>时，预测值<span class="math notranslate nohighlight">\(\hat{y}_{12}^{(1)}=993.6\)</span>预测的标准误差为</p>
<div class="math notranslate nohighlight">
\[
S_{1}=\sqrt{\frac{\sum_{i=5}^{11}\left(\hat{y}_{t}^{(1)}-y_{t}\right)^{2}}{11-4}}=150.5
\]</div>
<p>当<span class="math notranslate nohighlight">\(N=5\)</span>时，预测值<span class="math notranslate nohighlight">\(\hat{y}_{12}^{(1)}=958.2\)</span>预测的标准误差为</p>
<div class="math notranslate nohighlight">
\[
S_{2}=\sqrt{\frac{\sum_{t=6}^{11}\left(\hat{y}_{t}^{(1)}-y_{t}\right)^{2}}{11-5}}=182.4
\]</div>
<p>计算结果表明，<span class="math notranslate nohighlight">\(N = 4\)</span>时，预测的标准误差较小，所以选取<span class="math notranslate nohighlight">\(N = 4\)</span>。预测第 12 月份的销售收入为993.6。</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">x</span> <span class="o">=</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="mi">6</span><span class="p">,</span> <span class="mi">7</span><span class="p">,</span> <span class="mi">8</span><span class="p">,</span> <span class="mi">9</span><span class="p">,</span> <span class="mi">10</span><span class="p">,</span> <span class="mi">11</span><span class="p">]</span>  <span class="c1"># 输入x值</span>
<span class="n">y</span> <span class="o">=</span> <span class="p">[</span>
    <span class="mf">533.8</span><span class="p">,</span>
    <span class="mf">574.6</span><span class="p">,</span>
    <span class="mf">606.9</span><span class="p">,</span>
    <span class="mf">649.8</span><span class="p">,</span>
    <span class="mf">705.1</span><span class="p">,</span>
    <span class="mf">772.0</span><span class="p">,</span>
    <span class="mf">816.4</span><span class="p">,</span>
    <span class="mf">892.7</span><span class="p">,</span>
    <span class="mf">963.9</span><span class="p">,</span>
    <span class="mf">1015.1</span><span class="p">,</span>
    <span class="mf">1102.7</span><span class="p">]</span>  <span class="c1"># 输入y值</span>
<span class="n">plt</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">)</span>  <span class="c1"># 绘制散点图</span>
<span class="n">N</span> <span class="o">=</span> <span class="mi">4</span>  <span class="c1"># 选择N=4</span>
<span class="n">y12</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">y</span><span class="p">[</span><span class="o">-</span><span class="mi">4</span><span class="p">:])</span>  <span class="c1"># 进行移动平均预测</span>
<span class="n">plt</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span><span class="mi">12</span><span class="p">,</span> <span class="n">y12</span><span class="p">)</span>  <span class="c1"># 绘制移动平均结果</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>&lt;matplotlib.collections.PathCollection at 0x124794b10&gt;
</pre></div>
</div>
<img alt="../_images/prediction_model_39_1.png" src="../_images/prediction_model_39_1.png" />
</div>
</div>
<p>简单移动平均法<strong>只适合做近期预测</strong>，而且是预测目标的<strong>发展趋势变化不大</strong>的情况。如果目标的发展趋势存在其它的变化，采用简单移动平均法就会产生较大的预测偏差和滞后。</p>
</div>
<div class="section" id="id12">
<h4><span class="section-number">3.4.1.2. </span>加权移动平均法<a class="headerlink" href="#id12" title="Permalink to this headline">¶</a></h4>
<p>在简单移动平均公式中，每期数据在求平均时的作用是等同的。但是，每期数据所包含的信息量不一样，近期数据包含着更多关于未来情况的信心。因此，把各期数据等同看待是不尽合理的，应考虑各期数据的重要性，对近期数据给予较大的权重，这就是加权移动平均法(Weighted Moving Average Method)的基本思想。</p>
<p>设观测序列为<span class="math notranslate nohighlight">\(y_{1}, \cdots, y_{T}\)</span>,加权移动平均值计算公式为：</p>
<div class="math notranslate nohighlight">
\[
\hat{y}_{t+1}=\frac{w_{1} y_{t}+w_{2} y_{t-1}+\cdots+w_{N} y_{t-N+1}}{w_{1}+w_{2}+\cdots+w_{N}}, t \geq N
\]</div>
<p>式中，<span class="math notranslate nohighlight">\(\hat{y}_{t+1}\)</span>为<span class="math notranslate nohighlight">\(t+1\)</span>期的预测值；<span class="math notranslate nohighlight">\(w_i\)</span>为<span class="math notranslate nohighlight">\(y_{t-i+1}\)</span>的权数，它体现了相应的<span class="math notranslate nohighlight">\(y_t\)</span>在加权平均数中的重要性。</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">x</span> <span class="o">=</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="mi">6</span><span class="p">,</span> <span class="mi">7</span><span class="p">,</span> <span class="mi">8</span><span class="p">,</span> <span class="mi">9</span><span class="p">,</span> <span class="mi">10</span><span class="p">,</span> <span class="mi">11</span><span class="p">]</span>  <span class="c1"># 输入x值</span>
<span class="n">y</span> <span class="o">=</span> <span class="p">[</span>
    <span class="mf">533.8</span><span class="p">,</span>
    <span class="mf">574.6</span><span class="p">,</span>
    <span class="mf">606.9</span><span class="p">,</span>
    <span class="mf">649.8</span><span class="p">,</span>
    <span class="mf">705.1</span><span class="p">,</span>
    <span class="mf">772.0</span><span class="p">,</span>
    <span class="mf">816.4</span><span class="p">,</span>
    <span class="mf">892.7</span><span class="p">,</span>
    <span class="mf">963.9</span><span class="p">,</span>
    <span class="mf">1015.1</span><span class="p">,</span>
    <span class="mf">1102.7</span><span class="p">]</span>  <span class="c1"># 输入y值</span>
<span class="n">plt</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">)</span>  <span class="c1"># 绘制散点图</span>
<span class="n">N</span> <span class="o">=</span> <span class="mi">4</span>  <span class="c1"># 选择移动平均项数</span>
<span class="n">w</span> <span class="o">=</span> <span class="p">[</span><span class="mf">0.1</span><span class="p">,</span> <span class="mf">0.2</span><span class="p">,</span> <span class="mf">0.3</span><span class="p">,</span> <span class="mf">0.4</span><span class="p">]</span>  <span class="c1"># 指定权重</span>
<span class="n">y12</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">y</span><span class="p">[</span><span class="o">-</span><span class="mi">4</span><span class="p">:])</span>  <span class="c1"># 简单移动平均预测12月份收入</span>
<span class="n">y12_weighted</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="n">y</span><span class="p">[</span><span class="o">-</span><span class="mi">4</span><span class="p">:],</span> <span class="n">w</span><span class="p">)</span>  <span class="c1"># 加权移动平均预测12月份收入</span>
<span class="n">plt</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span><span class="mi">12</span><span class="p">,</span> <span class="n">y12</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;Simple Moving Average&#39;</span><span class="p">)</span>  <span class="c1"># 绘制简单移动平均结果</span>
<span class="n">plt</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span><span class="mi">12</span><span class="p">,</span> <span class="n">y12_weighted</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;Weighted Moving Average&#39;</span><span class="p">)</span>  <span class="c1"># 绘制加权移动平均结果</span>
<span class="n">plt</span><span class="o">.</span><span class="n">legend</span><span class="p">()</span>  <span class="c1"># 加入图例</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>&lt;matplotlib.legend.Legend at 0x12134ce10&gt;
</pre></div>
</div>
<img alt="../_images/prediction_model_42_1.png" src="../_images/prediction_model_42_1.png" />
</div>
</div>
<p>在加权移动平均法中， <span class="math notranslate nohighlight">\(w_t\)</span>的选择，同样具有一定的经验性。一般的原则是：近期数据的权数大，远期数据的权数小。至于大到什么程度和小到什么程度，则需要按照预测者对序列的了解和分析来确定。</p>
</div>
<div class="section" id="id13">
<h4><span class="section-number">3.4.1.3. </span>趋势移动平均法<a class="headerlink" href="#id13" title="Permalink to this headline">¶</a></h4>
<p>下面讨论如何利用移动平均的滞后偏差建立直线趋势预测模型。设时间序列<span class="math notranslate nohighlight">\(\left\{y_{t}\right\}\)</span>从某时期开始具有直线趋势，且认为未来时期也按此直线趋势变化，则可设此直线趋势预测模型为</p>
<div class="math notranslate nohighlight">
\[
\hat{y}_{t+T}=a_{t}+b_{t} T, \quad T=1,2, \cdots 
\tag{1}
\]</div>
<p>其中 <span class="math notranslate nohighlight">\(t\)</span> 为当前时期数；<span class="math notranslate nohighlight">\(T\)</span> 为由<span class="math notranslate nohighlight">\(t\)</span>至预测期的时期数； <span class="math notranslate nohighlight">\(a_t\)</span> 为截距； <span class="math notranslate nohighlight">\(b_t\)</span> 为斜率。两者又称为平滑系数。</p>
<p>现在，我们根据移动平均值来确定平滑系数。由模型(1)可知</p>
<div class="math notranslate nohighlight">
\[\begin{split}
\begin{aligned}
&amp;a_{t}=y_{t}\\
&amp;y_{t-1}=y_{t}-b_{t}\\
&amp;y_{t-2}=y_{t}-2 b_{t}\\
&amp;y_{t-N+1}=y_{t}-(N-1) b_{t}
\end{aligned}
\end{split}\]</div>
<p>所以</p>
<div class="math notranslate nohighlight">
\[\begin{split}
\begin{aligned}
M_{t}^{(1)} &amp;=\frac{y_{t}+y_{t-1}+\cdots+y_{t-N+1}}{N}=\frac{y_{t}+\left(y_{t}-b_{t}\right)+\cdots+\left[y_{t}-(N-1) b_{t}\right]}{N} \\
&amp;=\frac{N y_{t}-[1+2+\cdots+(N-1)] b_{t}}{N}=y_{t}-\frac{N-1}{2} b_{t}
\end{aligned}
\end{split}\]</div>
<p>因此</p>
<div class="math notranslate nohighlight">
\[
y_{t}-M_{t}^{(1)}=\frac{N-1}{2} b_{t}
\tag{2}
\]</div>
<p>类似以上的推导，我们还可以得到</p>
<div class="math notranslate nohighlight">
\[
y_{t-1}-M_{t-1}^{(1)}=\frac{N-1}{2} b_{t}
\]</div>
<p>所以</p>
<div class="math notranslate nohighlight">
\[
y_{t}-y_{t-1}=M_{t}^{(1)}-M_{t-1}^{(1)}=b_{t}
\]</div>
<p>类似式（2）的推导，可得</p>
<div class="math notranslate nohighlight">
\[
M_{t}^{(1)}-M_{t}^{(2)}=\frac{N-1}{2} b_{t}
\tag{3}
\]</div>
<p>于是，由式（2）和式（3）可得平滑系数的计算公式为</p>
<div class="math notranslate nohighlight">
\[\begin{split}
\left\{\begin{array}{l}
{a_{t}=2 M_{t}^{(1)}-M_{t}^{(2)}} \\
{b_{t}=\dfrac{2}{N-1}\left(M_{t}^{(1)}-M_{t}^{(2)}\right)}
\end{array}\right.
\end{split}\]</div>
<p>继续沿用上面的例子，进行趋势移动平均的计算</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># 趋势移动平均代码</span>
<span class="k">def</span> <span class="nf">moveingAverage</span><span class="p">(</span><span class="n">data</span><span class="p">,</span><span class="n">N</span><span class="p">):</span>
    <span class="n">temp</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">temp</span><span class="p">)):</span>
        <span class="k">if</span> <span class="n">i</span> <span class="o">&gt;=</span>  <span class="n">N</span> <span class="p">:</span>
            <span class="n">temp</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="n">i</span><span class="o">-</span><span class="n">N</span><span class="p">:</span><span class="n">i</span><span class="p">])</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">temp</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="k">return</span> <span class="n">temp</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">x</span> <span class="o">=</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="mi">3</span><span class="p">,</span><span class="mi">4</span><span class="p">,</span><span class="mi">5</span><span class="p">,</span><span class="mi">6</span><span class="p">,</span><span class="mi">7</span><span class="p">,</span><span class="mi">8</span><span class="p">,</span><span class="mi">9</span><span class="p">,</span><span class="mi">10</span><span class="p">,</span><span class="mi">11</span><span class="p">]</span>
<span class="n">y</span> <span class="o">=</span>  <span class="p">[</span><span class="mf">533.8</span><span class="p">,</span><span class="mf">574.6</span><span class="p">,</span><span class="mf">606.9</span><span class="p">,</span><span class="mf">649.8</span><span class="p">,</span><span class="mf">705.1</span><span class="p">,</span><span class="mf">772.0</span> <span class="p">,</span><span class="mf">816.4</span><span class="p">,</span> <span class="mf">892.7</span><span class="p">,</span><span class="mf">963.9</span><span class="p">,</span><span class="mf">1015.1</span><span class="p">,</span><span class="mf">1102.7</span><span class="p">]</span>
<span class="n">plt</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span><span class="n">x</span><span class="p">,</span><span class="n">y</span><span class="p">)</span>
<span class="n">N</span> <span class="o">=</span> <span class="mi">4</span>
<span class="n">w</span> <span class="o">=</span> <span class="p">[</span><span class="mf">0.1</span><span class="p">,</span><span class="mf">0.2</span><span class="p">,</span><span class="mf">0.3</span><span class="p">,</span><span class="mf">0.4</span><span class="p">]</span>
<span class="n">y12</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">y</span><span class="p">[</span><span class="o">-</span><span class="mi">4</span><span class="p">:])</span>
<span class="n">y12_weighted</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="n">y</span><span class="p">[</span><span class="o">-</span><span class="mi">4</span><span class="p">:],</span><span class="n">w</span><span class="p">)</span>

<span class="c1"># 趋势移动平均代码</span>
<span class="n">N</span> <span class="o">=</span> <span class="mi">4</span>
<span class="n">MA1</span> <span class="o">=</span> <span class="n">moveingAverage</span><span class="p">(</span><span class="n">y</span><span class="p">,</span><span class="n">N</span><span class="p">)</span>
<span class="n">MA2</span> <span class="o">=</span> <span class="n">moveingAverage</span><span class="p">(</span><span class="n">MA1</span><span class="p">,</span><span class="n">N</span><span class="p">)</span>
<span class="n">at</span> <span class="o">=</span> <span class="mi">2</span> <span class="o">*</span> <span class="n">MA1</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">-</span> <span class="n">MA2</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
<span class="n">bt</span> <span class="o">=</span> <span class="mi">2</span><span class="o">/</span><span class="p">(</span><span class="n">N</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span> <span class="o">*</span> <span class="p">(</span><span class="n">MA1</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">-</span> <span class="n">MA2</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span>

<span class="n">y_hat</span> <span class="o">=</span> <span class="n">at</span> <span class="o">+</span> <span class="n">bt</span> <span class="o">*</span> <span class="mi">1</span>

<span class="n">plt</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span><span class="mi">12</span><span class="p">,</span><span class="n">y12</span><span class="p">,</span><span class="n">label</span> <span class="o">=</span> <span class="s1">&#39;Simple Moving Average&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span><span class="mi">12</span><span class="p">,</span><span class="n">y12_weighted</span><span class="p">,</span><span class="n">label</span> <span class="o">=</span> <span class="s1">&#39;Weighted Moving Average&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span><span class="mi">12</span><span class="p">,</span><span class="n">y_hat</span><span class="p">,</span><span class="n">label</span> <span class="o">=</span> <span class="s1">&#39;Moving Average Concerning Trends&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">legend</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>&lt;matplotlib.legend.Legend at 0x1242f3ad0&gt;
</pre></div>
</div>
<img alt="../_images/prediction_model_48_1.png" src="../_images/prediction_model_48_1.png" />
</div>
</div>
<p>趋势移动平均法对于同时存在直线趋势与周期波动的序列，是一种既能反映趋势变化，又可以有效地分离出来周期变动的方法。</p>
</div>
<div class="section" id="id14">
<h4><span class="section-number">3.4.1.4. </span>自适应滤波法<a class="headerlink" href="#id14" title="Permalink to this headline">¶</a></h4>
<p>自适应滤波法（Adaptive filtering）与移动平均法、指数平滑法一样，也是以时间序列的历史观测值进行某种加权平均来预测的，它要寻找一组“最佳”的权数，其办法是先用一组给定的权数来计算一个预测值，然后计算预测误差，再根据预测误差调整权数以减少误差。这样反复进行，直至找出一组“最佳”权数，使误差减少到最低限度。由于这种调整权数的过程与通讯工程中的传输噪声过滤过程极为接近，故称为自适应滤波法。</p>
<p>自适应滤波法的基本预测公式为</p>
<div class="math notranslate nohighlight">
\[
\hat{y}_{t+1}=w_{1} y_{t}+w_{2} y_{t-1}+\cdots+w_{N} y_{t-N+1}=\sum_{i=1}^{N} w_{i} y_{t-i+1}
\]</div>
<p>式中,<span class="math notranslate nohighlight">\(\hat{y}_{t+1}\)</span>为第<span class="math notranslate nohighlight">\(t +1\)</span>期的预测值,<span class="math notranslate nohighlight">\(w_i\)</span>为第<span class="math notranslate nohighlight">\(t-i+1\)</span>期的观测权数。其调整权数的公式为</p>
<div class="math notranslate nohighlight">
\[
w_{i}^{\prime}=w_{i}+2 k \cdot e_{i+1} y_{t-i+1}
\]</div>
<p>式中,<span class="math notranslate nohighlight">\(i=1,2, \cdots, N, t=N, N+1, \cdots, n\)</span>,n为序列数据的个数,<span class="math notranslate nohighlight">\(w_i\)</span> 为调整前的第<span class="math notranslate nohighlight">\(i\)</span>个权数，<span class="math notranslate nohighlight">\(w_{i}^{\prime}\)</span>为调整后的第<span class="math notranslate nohighlight">\(i\)</span>个权数，<span class="math notranslate nohighlight">\(k\)</span>为学习常数，<span class="math notranslate nohighlight">\(e_{i+1}\)</span>为第<span class="math notranslate nohighlight">\(t +1\)</span>期的预测误差。</p>
<p>上式表明：调整后的一组权数应等于旧的一组权数加上误差调整项，这个调整项包括预测误差、原观测值和学习常数等三个因素。学习常数<span class="math notranslate nohighlight">\(k\)</span>的大小决定权数调整的速度。</p>
<p>下面举一个简单的例子来说明此法的全过程。设有一个时间序列包括10 个观测值，如下表所示。试用自适应滤波法，以两个权数来求第11 期的预测值。</p>
<table class="colwidths-auto table">
<thead>
<tr class="row-odd"><th class="head"><p>时期</p></th>
<th class="head"><p>1</p></th>
<th class="head"><p>2</p></th>
<th class="head"><p>3</p></th>
<th class="head"><p>4</p></th>
<th class="head"><p>5</p></th>
<th class="head"><p>6</p></th>
<th class="head"><p>7</p></th>
<th class="head"><p>8</p></th>
<th class="head"><p>9</p></th>
<th class="head"><p>10</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>观测值</p></td>
<td><p>0.1</p></td>
<td><p>0.2</p></td>
<td><p>0.3</p></td>
<td><p>0.4</p></td>
<td><p>0.5</p></td>
<td><p>0.6</p></td>
<td><p>0.7</p></td>
<td><p>0.8</p></td>
<td><p>0.9</p></td>
<td><p>1</p></td>
</tr>
</tbody>
</table>
<p>本例中<span class="math notranslate nohighlight">\(N = 2\)</span>。取初始权数 <span class="math notranslate nohighlight">\(w_1 = 0.5\)</span>， <span class="math notranslate nohighlight">\(w_2 = 0.5\)</span> ，并设<span class="math notranslate nohighlight">\(k = 0.9\)</span>。<span class="math notranslate nohighlight">\(t\)</span>的取值由<span class="math notranslate nohighlight">\(N = 2\)</span>开始，当<span class="math notranslate nohighlight">\(t=2\)</span>时：</p>
<ol class="simple">
<li><p>按预测公式,求第<span class="math notranslate nohighlight">\(t +1= 3\)</span>期的预测值。</p></li>
</ol>
<div class="math notranslate nohighlight">
\[
\hat{y}_{t+1}=\hat{y}_{3}=w_{1} y_{2}+w_{2} y_{1}=0.15
\]</div>
<ol class="simple">
<li><p>计算预测误差。</p></li>
</ol>
<div class="math notranslate nohighlight">
\[
e_{t+1}=e_{3}=y_{3}-\hat{y}_{3}=0.3-0.15=0.15
\]</div>
<ol class="simple">
<li><p>更新权重</p></li>
</ol>
<div class="math notranslate nohighlight">
\[
w_{i}^{\prime}=w_{i}+2 k \cdot e_{i+1} y_{t-i+1}
\]</div>
<p>展开就是，</p>
<div class="math notranslate nohighlight">
\[\begin{split}
\begin{aligned}
&amp;w_{1}^{\prime}=w_{1}+2 k e_{3} y_{2}=0.554\\
&amp;w_{2}^{\prime}=w_{2}+2 k e_{3} y_{1}=0.527
\end{aligned}
\end{split}\]</div>
<p>依次类推，我们可以按照同样的规律从4-10继续调整权重，这时，第一轮调整就此结束。</p>
<p>把现有的新权数作为初始权数，重新开始<span class="math notranslate nohighlight">\(t = 2\)</span>的过程。这样反复进行下去，到预测误差（指新一轮的预测总误差）没有明显改进时，就认为获得了一组“最佳”权数，能实际用来预测第11 期的数值。本例在调整过程中，可使得误差降为零，而权数达到稳定不变，最后得到的“最佳”权数为</p>
<div class="math notranslate nohighlight">
\[
w_{1}^{\prime}=2.0, \quad w_{2}^{\prime}=-1.0
\]</div>
<p>用“最佳”权数预测第 11 期的取值</p>
<div class="math notranslate nohighlight">
\[
\hat{y}_{11}=w_{1}^{\prime} y_{10}+w_{2}^{\prime} y_{9}=1.1
\]</div>
<p>在实际应用中，权数调整计算工作量可能很大，必须借助于计算机才能实现。</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">yt</span><span class="o">=</span><span class="p">[</span><span class="mf">0.1</span> <span class="o">*</span> <span class="n">i</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">11</span><span class="p">)]</span>
<span class="n">m</span><span class="o">=</span><span class="nb">len</span><span class="p">(</span><span class="n">yt</span><span class="p">)</span>
<span class="n">k</span><span class="o">=</span><span class="mf">0.9</span>
<span class="n">N</span><span class="o">=</span><span class="mi">2</span>
<span class="n">Terr</span><span class="o">=</span><span class="mi">10000</span>
<span class="n">w</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">ones</span><span class="p">(</span><span class="n">N</span><span class="p">)</span><span class="o">/</span><span class="n">N</span>
<span class="k">while</span> <span class="nb">abs</span><span class="p">(</span><span class="n">Terr</span><span class="p">)</span><span class="o">&gt;</span><span class="mf">0.00001</span><span class="p">:</span>
    <span class="n">Terr</span><span class="o">=</span><span class="p">[]</span>
    <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">N</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span><span class="n">m</span><span class="p">):</span>
        <span class="n">yhat</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="n">w</span><span class="p">,</span><span class="n">yt</span><span class="p">[</span><span class="n">j</span><span class="o">-</span><span class="n">N</span><span class="p">:</span><span class="n">j</span><span class="p">])</span>
        <span class="n">err</span> <span class="o">=</span> <span class="n">yt</span><span class="p">[</span><span class="n">j</span><span class="p">]</span> <span class="o">-</span> <span class="n">yhat</span>
        <span class="n">Terr</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">err</span><span class="p">)</span>
        <span class="n">w</span> <span class="o">=</span> <span class="n">w</span> <span class="o">+</span> <span class="mi">2</span><span class="o">*</span><span class="n">k</span><span class="o">*</span><span class="n">err</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">yt</span><span class="p">[</span><span class="n">j</span><span class="o">-</span><span class="n">N</span><span class="p">:</span><span class="n">j</span><span class="p">])</span>
    <span class="n">Terr</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="n">Terr</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<p><strong><span class="math notranslate nohighlight">\(N\)</span>, <span class="math notranslate nohighlight">\(k\)</span>值和初始权数的确定</strong></p>
<p>在开始调整权数时，首先要确定权数个数<span class="math notranslate nohighlight">\(N\)</span>和学习常数<span class="math notranslate nohighlight">\(k\)</span> 。一般说来，当时间序列的观测值呈季节变动时， <span class="math notranslate nohighlight">\(N\)</span> 应取季节性长度值。如序列以一年为周期进行季节变动时，若数据是月度的，则取<span class="math notranslate nohighlight">\(N = 12\)</span>，若季节是季度的，则取<span class="math notranslate nohighlight">\(N = 4\)</span>。如果时间序列无明显的周期变动，则可用自相关系数法来确定，即取<span class="math notranslate nohighlight">\(N\)</span>为最高自相关系数的滞后时期。</p>
<p><span class="math notranslate nohighlight">\(k\)</span>的取值一般可定为<span class="math notranslate nohighlight">\(1/N\)</span> ，也可以用不同的<span class="math notranslate nohighlight">\(k\)</span>值来进行计算，以确定一个能使<span class="math notranslate nohighlight">\(S\)</span>最小的<span class="math notranslate nohighlight">\(k\)</span>值。</p>
<p>初始权数的确定也很重要，如无其它依据，也可用<span class="math notranslate nohighlight">\(1/ N\)</span> 作为初始权系数用，即</p>
<div class="math notranslate nohighlight">
\[
w_{i}=\frac{1}{N}(i=1,2, \cdots, N)
\]</div>
<p>自适应滤波法有两个明显的优点：</p>
<ul class="simple">
<li><p>一是技术比较简单，可根据预测意图来选择权数的个数和学习常数，以控制预测。也可以由计算机自动选定。</p></li>
<li><p>二是它使用了全部历史数据来寻求最佳权系数，并随数据轨迹的变化而不断更新权数，从而不断改进预测。由于自适应滤波法的预测模型简单，又可以在计算机上对数据进行处理，所以这种预测方法应用较为广泛。</p></li>
</ul>
</div>
</div>
</div>
<div class="section" id="id15">
<h2><span class="section-number">3.5. </span>预测方法总结<a class="headerlink" href="#id15" title="Permalink to this headline">¶</a></h2>
<p><strong>回归分析法：</strong> 适合中、小样本预测
<strong>时间序列方法：</strong> 适合中、大样本的随机因素或周期特征的未来趋势未来预测</p>
</div>
<div class="section" id="id16">
<h2><span class="section-number">3.6. </span>练习<a class="headerlink" href="#id16" title="Permalink to this headline">¶</a></h2>
<div class="admonition- admonition">
<p class="admonition-title">练习1</p>
<p>给出下面的<code class="docutils literal notranslate"><span class="pre">interest</span> <span class="pre">rate</span></code>，<code class="docutils literal notranslate"><span class="pre">unemployment</span> <span class="pre">rate</span></code>和<code class="docutils literal notranslate"><span class="pre">stock</span> <span class="pre">index</span> <span class="pre">price</span></code>的数据，请你通过多元线性回归的方法，通过<code class="docutils literal notranslate"><span class="pre">interest</span> <span class="pre">rate</span></code>，<code class="docutils literal notranslate"><span class="pre">unemployment</span> <span class="pre">rate</span></code>来预测<code class="docutils literal notranslate"><span class="pre">stock</span> <span class="pre">index</span> <span class="pre">price</span></code>。给出你所得到的计算公式。你可以调用 <code class="docutils literal notranslate"><span class="pre">sklearn.linear_model</span></code>中的 <code class="docutils literal notranslate"><span class="pre">LinearRegression</span></code> 函数，关于该函数的使用方法，可以参考官方文档。</p>
<p><img alt="Image Name" src="https://cdn.kesci.com/upload/image/qgbqq4833c.png?imageView2/0/w/960/h/960" /></p>
</div>
</div>
</div>

    <script type="text/x-thebe-config">
    {
        requestKernel: true,
        binderOptions: {
            repo: "binder-examples/jupyter-stacks-datascience",
            ref: "master",
        },
        codeMirrorConfig: {
            theme: "abcdef",
            mode: "python"
        },
        kernelOptions: {
            kernelName: "python3",
            path: "./docs"
        },
        predefinedOutput: true
    }
    </script>
    <script>kernelName = 'python3'</script>

              </div>
              
        </div>
    </div>
    
    
    <div class='prev-next-bottom'>
        
    <a class='left-prev' id="prev-link" href="evaluation_model.html" title="previous page"><span class="section-number">2. </span>评价模型</a>
    <a class='right-next' id="next-link" href="ode_model.html" title="next page"><span class="section-number">4. </span>微分方程模型</a>

    </div>
    <footer class="footer mt-5 mt-md-0">
    <div class="container">
      <p>
        
          By The Jupyter Book community<br/>
        
            &copy; Copyright 2020.<br/>
      </p>
    </div>
  </footer>
</main>


      </div>
    </div>

    <script src="../_static/js/index.js"></script>
    
  </body>
</html>